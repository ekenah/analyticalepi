<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>6&nbsp; One-Sample Survival Analysis – Analytical Epidemiology</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./studydesign.html" rel="next">
<link href="./longitudinal.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-747bc48f972f7c4036e4d8e8c6d9e55a.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script>
  window.MathJax = {
    tex: {
      macros: {
        A: "\\mathcal\{A\}",
        approxsim: "\\stackrel\{\\text\{approx\}\}\{\\sim\}",
        B: "\\mathcal\{B\}",
        Bernoulli: ["\\operatorname\{Bernoulli\}"],
        binomial: ["\\operatorname\{binomial\}"],
        C: "\\mathcal\{C\}",
        chisqH: "\\chi^2_\\text\{H\}",
        chisqP: "\\chi^2_\\text\{P\}",
        chisqPobs: "\\chi^2_\\text\{Pobs\}",
        cloglog: ["\\operatorname\{cloglog\}"],
        comp: "\\mathsf\{C\}",
        Cov: ["\\operatorname\{Cov\}"],
        D: "\\mathcal\{D\}",
        data: "\\text\{data\}",
        dif: "\\text\{d\}",
        Dminus: "\\text\{D\}^-",
        Dplus: "\\text\{D\}^+",
        E: ["\\operatorname\{\\mathbb\{E\}\}"],
        ESSR: "\\text\{ESSR\}",
        expit: ["\\operatorname\{expit\}"],
        given: ["\\, #1| \\, ", 1],
        HR: "\\text\{HR\}",
        indep: "\\perp\\!\\!\\!\\perp",
        indicator: "\\mathbb\{1\}",
        IRR: "\\text\{IRR\}",
        K: "\\mathcal\{K\}",
        logit: ["\\operatorname\{logit\}"],
        margins: "\\text\{margins\}",
        obs: "\\text\{obs\}",
        odds: ["\\operatorname\{odds\}"],
        OR: "\\text\{OR\}",
        ptrue: "p_\{\\text\{true\}\}",
        R: "\\mathcal\{R\}",
        RD: "\\text\{RD\}",
        RR: "\\text\{RR\}",
        sens: "\\text\{sens\}",
        spec: "\\text\{spec\}",
        supp: ["\\operatorname\{supp\}"],
        tcens: "t^\\text\{cens\}",
        tentry: "t^\\text\{entry\}",
        tevent: "t^\\text\{event\}",
        texit: "t^\\text\{exit\}",
        Tminus: "\\text\{T\}^-",
        tonset: "t^\\text\{onset\}",
        Tplus: "\\text\{T\}^+",
        transpose: "\\mathsf{T}",
        trec: "t^\\text\{rec\}",
        true: "\\text\{true\}",
        twobytwo: "2 \\times 2",
        vand: "\\text\{ and \}",
        Var: ["\\operatorname\{Var\}"],
        Xminus: "\\text\{X\}^-",
        Xobs: "\\text\{X\}^\\text\{obs\}",
        Xplus: "\\text\{X\}^+"
      }
    }
  };
</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./probability.html">Defining and Measuring Disease Occurrence</a></li><li class="breadcrumb-item"><a href="./survival.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">One-Sample Survival Analysis</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Analytical Epidemiology</a> 
        <div class="sidebar-tools-main">
    <a href="./Analytical-Epidemiology.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Defining and Measuring Disease Occurrence</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./probability.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Probability, Random Variables, and Disease Occurrence</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./condprob.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Conditional Probability and Diagnostic Tests</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mlestimation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Maximum Likelihood Estimation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bayes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Bayesian Estimation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./longitudinal.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Longitudinal Data, Rates, and Counts</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./survival.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">One-Sample Survival Analysis</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Study Design and Measures of Association</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./studydesign.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Cohort and Case-Control Studies</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./validity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Internal and External Validity</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cohort.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Measures of Association in Cohort Studies</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./survival2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Two-Sample Survival Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./casecontrol.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Measures of association in case-control studies</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bayes2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Bayesian analysis of cohort and case-control studies</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Principles of Causal Inference</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Epidemologic and Statistical Methods for Causal Inference</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./calculus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Calculus</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="2">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#empirical-cumulative-distribution-function" id="toc-empirical-cumulative-distribution-function" class="nav-link active" data-scroll-target="#empirical-cumulative-distribution-function"><span class="header-section-number">6.1</span> Empirical cumulative distribution function</a></li>
  <li><a href="#sec-KM" id="toc-sec-KM" class="nav-link" data-scroll-target="#sec-KM"><span class="header-section-number">6.2</span> Kaplan-Meier estimator</a>
  <ul class="collapse">
  <li><a href="#sec-risksets" id="toc-sec-risksets" class="nav-link" data-scroll-target="#sec-risksets"><span class="header-section-number">6.2.1</span> At-risk process and risk sets</a></li>
  <li><a href="#survival-via-multiplication-of-conditional-probabilities" id="toc-survival-via-multiplication-of-conditional-probabilities" class="nav-link" data-scroll-target="#survival-via-multiplication-of-conditional-probabilities"><span class="header-section-number">6.2.2</span> Survival via multiplication of conditional probabilities</a></li>
  <li><a href="#greenwood-formula-and-confidence-intervals" id="toc-greenwood-formula-and-confidence-intervals" class="nav-link" data-scroll-target="#greenwood-formula-and-confidence-intervals"><span class="header-section-number">6.2.3</span> Greenwood formula and confidence intervals</a></li>
  <li><a href="#cumulative-incidence-and-cumulative-hazard" id="toc-cumulative-incidence-and-cumulative-hazard" class="nav-link" data-scroll-target="#cumulative-incidence-and-cumulative-hazard"><span class="header-section-number">6.2.4</span> Cumulative incidence and cumulative hazard</a></li>
  </ul></li>
  <li><a href="#sec-NA" id="toc-sec-NA" class="nav-link" data-scroll-target="#sec-NA"><span class="header-section-number">6.3</span> Nelson-Aalen estimator</a>
  <ul class="collapse">
  <li><a href="#sec-FH" id="toc-sec-FH" class="nav-link" data-scroll-target="#sec-FH"><span class="header-section-number">6.3.1</span> Cumulative hazard via addition of expected values</a></li>
  <li><a href="#variance-and-confidence-intervals" id="toc-variance-and-confidence-intervals" class="nav-link" data-scroll-target="#variance-and-confidence-intervals"><span class="header-section-number">6.3.2</span> Variance and confidence intervals</a></li>
  <li><a href="#survival-and-cumulative-incidence-functions" id="toc-survival-and-cumulative-incidence-functions" class="nav-link" data-scroll-target="#survival-and-cumulative-incidence-functions"><span class="header-section-number">6.3.3</span> Survival and cumulative incidence functions</a></li>
  </ul></li>
  <li><a href="#parametric-failure-time-distributions" id="toc-parametric-failure-time-distributions" class="nav-link" data-scroll-target="#parametric-failure-time-distributions"><span class="header-section-number">6.4</span> Parametric failure time distributions</a>
  <ul class="collapse">
  <li><a href="#weibull-distribution" id="toc-weibull-distribution" class="nav-link" data-scroll-target="#weibull-distribution"><span class="header-section-number">6.4.1</span> Weibull distribution</a></li>
  <li><a href="#log-logistic-distribution" id="toc-log-logistic-distribution" class="nav-link" data-scroll-target="#log-logistic-distribution"><span class="header-section-number">6.4.2</span> Log-logistic distribution</a></li>
  <li><a href="#cox-snell-residuals" id="toc-cox-snell-residuals" class="nav-link" data-scroll-target="#cox-snell-residuals"><span class="header-section-number">6.4.3</span> Cox-Snell residuals</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./probability.html">Defining and Measuring Disease Occurrence</a></li><li class="breadcrumb-item"><a href="./survival.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">One-Sample Survival Analysis</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-survival1" class="quarto-section-identifier"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">One-Sample Survival Analysis</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<blockquote class="blockquote">
<p>In many estimation problems it is inconvenient or impossible to make complete measurements on all members of a random sample. For example, in medical follow-up studies to determine the distribution of survival times after an operation, contact with some individuals will be lost before their death, and others will die from causes it is desired to exclude from consideration. Similarly, observation of the life of a vacuum tube may be ended by breakage of the tube, or a need to use the test facilities for other purposes. In both examples, incomplete observations may also result from a need to get out a report within a reasonable time. <span class="citation" data-cites="kaplan1958nonparametric">(<a href="references.html#ref-kaplan1958nonparametric" role="doc-biblioref">Kaplan and Meier 1958</a>)</span></p>
</blockquote>
<p>In <strong>nonparametric</strong> survival analysis, we do not assume that the failure time distributions are defined by a small number of parameters, such as the rate parameter in an exponential model for times to events or a Poisson model for the number of events. Whenever possible, it is good to incorporate existing knowledge into the estimation of unknown parameters, and the use of parametric models and Bayesian methods accomplishes this. When such knowledge is not available, nonparametric methods allow us to avoid making assumptions we cannot defend.</p>
<p>However, this flexibility comes at a price. For example, suppose we know that our time-to-event has an exponential distribution. If we use a nonparametric model anyway, then:</p>
<ul>
<li>The nonparametric estimates of the survival, cumulative hazard, or hazard functions will be less precise than the estimates from an exponential model.</li>
<li>We might be unable to estimate mean or median survival times or other quantities that require extrapolation beyond the data used for estimation.</li>
</ul>
<p>Parametric and nonparametric methods are at opposite ends of the bias-variance tradeoff. The assumptions of parametric models can induce bias, but they produce estimates with low variance when the assumptions are approximately correct. The flexibility of nonparametric models avoids bias, but they produce estimates with higher variance than an equivalent parametric method based on sound assumptions. Survival analysis has nonparametric estimators of the survival and cumulative hazard functions that can be used with relatively little loss of efficiency. Because of this combination of flexibility and efficiency, they are widely used in epidemiologic research.</p>
<section id="empirical-cumulative-distribution-function" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="empirical-cumulative-distribution-function"><span class="header-section-number">6.1</span> Empirical cumulative distribution function</h2>
<p>The cumulative distribution function (CDF) of a random variable <span class="math inline">\(X\)</span> is the function <span class="math display">\[F(x) = \Pr(X \leq x).\]</span> For each value of <span class="math inline">\(x\)</span>, <span class="math inline">\(F(x)\)</span> is a probability that we can estimate using methods for a binomial proportion. However, we can get a more complete picture of the distribution of <span class="math inline">\(X\)</span> by linking the estimates for different <span class="math inline">\(x\)</span> together to estimate the whole function <span class="math inline">\(F(x)\)</span>.</p>
<p>If <span class="math inline">\(x_1, \ldots, x_n\)</span> are observations of a random variable <span class="math inline">\(X\)</span>, the <strong>empirical CDF</strong> is the function <span id="eq-hatF"><span class="math display">\[
  \hat{F}_n(x) = \frac{1}{n} \sum_{i = 1}^n \indicator_{x_i \leq x}
\tag{6.1}\]</span></span> where <span class="math inline">\(\indicator_{x_i \leq x} = 1\)</span> if <span class="math inline">\(x_i \leq x\)</span> is true and zero otherwise. For a fixed value of <span class="math inline">\(x\)</span>, <span class="math inline">\(\hat{F}_n(x)\)</span> is just the proportion of the observations that are <span class="math inline">\(\leq x\)</span>. At each <span class="math inline">\(x\)</span>, the number of observations with <span class="math inline">\(X_i \leq x\)</span> is a binomial(<span class="math inline">\(n\)</span>, <span class="math inline">\(F(x)\)</span>) random variable with expected value <span class="math inline">\(n F(x)\)</span> and variance <span class="math inline">\(n F(x) \big(1 - F(x)\big)\)</span>. Thus, <span class="math display">\[
  \E\bigl(\hat{F}_n(x)\bigr) = F(x)
\]</span> and <span id="eq-hatFvar"><span class="math display">\[
  \Var\bigl(\hat{F}_n(x)\bigr)
  = \frac{1}{n} F(x) \big(1 - F(x)\big).
\tag{6.2}\]</span></span> As <span class="math inline">\(n \rightarrow \infty\)</span>, we have <span class="math inline">\(\hat{F}_n(x) \rightarrow F(x)\)</span> by the law of large numbers (LLN) and By the central limit theorem (CLT), <span id="eq-hatFconv"><span class="math display">\[
    \frac{\sqrt{n}\big(\hat{F}_n(x) - F(x)\big)}{\sqrt{F(x) \big(1 - F(x)\big)}} \approxsim N(0, 1)
\tag{6.3}\]</span></span> by the central limit theorem (CLT).<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> Unlike a single proportion estimate <span class="math inline">\(\hat{p}\)</span>, the empirical CDF links all of these estimated probabilities together—like beads on a necklace—through the variable <span class="math inline">\(x\)</span>.</p>
<p>At any given <span class="math inline">\(x\)</span>, interval estimates for <span class="math inline">\(F(x)\)</span> can be obtained using any of the methods we have discussed for probabilities, including the Wald, score (Wilson), likelihood ratio, exact (Clopper-Pearson), mid-p, or Jeffreys confidence intervals as well as Bayesian credible intervals. For example, <span id="eq-hatFci"><span class="math display">\[
    \hat{F}_n(x) \pm 1.96 \sqrt{\frac{1}{n} \hat{F}_n(x) \big(1 - \hat{F}_n(x)\big)}
\tag{6.4}\]</span></span> is the 95% Wald confidence interval. To force this confidence interval to stay inside <span class="math inline">\((0, 1)\)</span>, we can use the delta method with a logit or log-log transformation. These are called <strong>pointwise</strong> confidence intervals because we have a separate confidence interval for <span class="math inline">\(F(x)\)</span> at each <span class="math inline">\(x\)</span>.</p>
</section>
<section id="sec-KM" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="sec-KM"><span class="header-section-number">6.2</span> Kaplan-Meier estimator</h2>
<p>In data with right censoring and left truncation, we cannot calculate the empirical CDF directly. The <strong>Kaplan-Meier estimator</strong> <span class="citation" data-cites="kaplan1958nonparametric">(<a href="references.html#ref-kaplan1958nonparametric" role="doc-biblioref">Kaplan and Meier 1958</a>)</span> uses conditional probabilities to estimate the survival function <span class="math inline">\(S(t) = 1 - F(t)\)</span> for failure time data.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> The basic idea behind the Kaplan-Meier estimator is to solve the problems of right censoring and left truncation (delayed entry) by breaking analysis time into periods where no one enters or leaves the study. In each such interval <span class="math inline">\((t_a, t_b]\)</span>, we can estimate the conditional probability of surviving to time <span class="math inline">\(t_b\)</span> given that you were at risk of disease at time <span class="math inline">\(t_a\)</span>.</p>
<p>If there are <span class="math inline">\(n\)</span> individuals at risk throughout the interval $(t_a, t_b], then the number of events at time <span class="math inline">\(t_b\)</span> can be treated like a binomial(<span class="math inline">\(n, p\)</span>) random variable where <span class="math inline">\(p\)</span> is the risk of the event in <span class="math inline">\((t_a, t_b]\)</span>. Our point estimate of this conditional probability is <span class="math display">\[
  \hat{p} = \frac{d}{n}
\]</span> where <span class="math inline">\(d\)</span> is the number of failures at time <span class="math inline">\(t_b\)</span>. Its variance is approximately <span class="math display">\[
  \Var(\hat{p}) = \frac{1}{n} \hat{p} (1 - \hat{p}).
\]</span> Given that you were at risk of disease at time <span class="math inline">\(t_a\)</span>, <span class="math display">\[
  \hat{q} = 1 - \hat{p}
\]</span> is the conditional probability of surviving past time <span class="math inline">\(t_b\)</span>.</p>
<section id="sec-risksets" class="level3" data-number="6.2.1">
<h3 data-number="6.2.1" class="anchored" data-anchor-id="sec-risksets"><span class="header-section-number">6.2.1</span> At-risk process and risk sets</h3>
<p>To estimate the risk in an interval <span class="math inline">\((t_a, t_b]\)</span>, it is critical to define who is at risk of failure at time <span class="math inline">\(t_a\)</span>. We assume that all times are defined relative to a time origin that can differ between individuals. The <strong>at-risk process</strong> for individual <span class="math inline">\(i\)</span> is <span class="math display">\[
  Y_i(t) =
  \begin{cases}
    1 &amp;\text{ if $i$ is at risk and under observation at time $t$},\\
    0 &amp;\text{ otherwise}.
  \end{cases}
\]</span> The at-risk process is assumed to be predictable (i.e., its value at <span class="math inline">\(t\)</span> is determined just before time <span class="math inline">\(t\)</span>), so <span class="math inline">\(Y_i(t) = 1\)</span> even if <span class="math inline">\(i\)</span> fails or is censored at time <span class="math inline">\(t\)</span>. Note that a person is only at risk if they are both at risk of failure and under observation. If person <span class="math inline">\(i\)</span> is not under observation until an entry time <span class="math inline">\(\tentry_i &gt; 0\)</span>, then <span class="math inline">\(Y_i(t) = 0\)</span> when <span class="math inline">\(t \leq \tentry_i\)</span>.</p>
<p>The set of individuals under observation and at risk of failure at time <span class="math inline">\(t\)</span> is called the <strong>risk set</strong> at time <span class="math inline">\(t\)</span> and written <span class="math display">\[
  \mathcal{R}(t) = \{i : Y_i(t) = 1\}
\]</span> The risk set <span class="math inline">\(\mathcal{R}(t)\)</span> includes everyone under observation who fails at time <span class="math inline">\(t\)</span>, who is censored at time <span class="math inline">\(t\)</span>, or who survives past time <span class="math inline">\(t\)</span>.</p>
</section>
<section id="survival-via-multiplication-of-conditional-probabilities" class="level3" data-number="6.2.2">
<h3 data-number="6.2.2" class="anchored" data-anchor-id="survival-via-multiplication-of-conditional-probabilities"><span class="header-section-number">6.2.2</span> Survival via multiplication of conditional probabilities</h3>
<p>Let <span class="math inline">\(T\)</span> denote the random failure time in the analysis time scale (i.e., with the origin as time zero), and suppose we have times <span class="math inline">\(0 &lt; t_1 &lt; t_2\)</span>. To have <span class="math inline">\(T &gt; t_2\)</span>, we must also have <span class="math inline">\(T &gt; t_1\)</span>, so <span class="math display">\[
  \begin{aligned}
    \Pr\bigl(T &gt; t_2\bigr)
    &amp;= \Pr\bigl(T &gt; t_2 \text{ and } T &gt; t_1\bigr) \\
    &amp;= \Pr\bigl(T &gt; t_2 \,\big|\, T &gt; t_1\bigr) \Pr\bigl(T &gt; t_1\bigr).
  \end{aligned}
\]</span> In other words, the probability of survival in <span class="math inline">\((0, t_2]\)</span> is the product of the survival probabilities in the intervals <span class="math inline">\((0, t_1]\)</span> and <span class="math inline">\((t_1, t_2]\)</span>. If <span class="math inline">\(t_3 &gt; t_2\)</span>, then <span class="math display">\[
  \begin{aligned}
    \Pr\bigl(T &gt; t_3\bigr)
    &amp;= \Pr\bigl(T &gt; t_3 \,\big|\, T &gt; t_2\bigr) \Pr\bigl(T &gt; t_2\bigr) \\
    &amp;= \Pr\bigl(T &gt; t_3 \,\big|\, T &gt; t_2\bigr)
      \Pr\bigl(T &gt; t_2 \,\big|\, T &gt; t_1\bigr) \Pr\bigl(T &gt; t_1\bigr)
  \end{aligned}
\]</span> which is the product of the survival probabilities in the intervals <span class="math inline">\((0, t_1]\)</span>, <span class="math inline">\((t_1, t_2]\)</span>, and <span class="math inline">\((t_2, t_3]\)</span>. This logic extends to any number of intervals. If we have distinct times <span class="math inline">\(0 = t_0 &lt; t_1 &lt; \cdots &lt; t_m\)</span>, then <span class="math display">\[
  \Pr(T &gt; t_m)
  = \prod_{i = 1}^{m} \Pr\big(T &gt; t_i \,\big|\, T &gt; t_{i - 1}\big).
\]</span> This uses the multiplication rule for conditional probabilities, so it does not assume that failures in different intervals are independent. In single-failure data, an individual who fails in one interval cannot fail in a later interval, so failures in different intervals cannot be independent.</p>
<p>Let <span class="math inline">\(0 = t_0 &lt; t_1 &lt; t_2 &lt; \ldots &lt; t_m\)</span> be the endpoints of intervals <span class="math inline">\((t_{i-1}, t_i]\)</span> within which there are no entries or exits from the study. Let <span class="math inline">\(n_j = \sum_{i = 1}^n Y_i(t_j)\)</span> be the number of people in the risk set <span class="math inline">\(\mathcal{R}(t_j)\)</span> and let <span class="math inline">\(d_j \geq 0\)</span> be the number of failures that occur at time <span class="math inline">\(t_j\)</span>. The estimated conditional probability <span class="math inline">\(q_j\)</span> of surviving through the interval <span class="math inline">\((t_{j - 1}, t_j]\)</span> given survival to <span class="math inline">\(t_{j - 1}\)</span> is <span class="math display">\[
  \hat{q}_j = 1 - \frac{d_j}{n_j},
\]</span> and the Kaplan-Meier estimator of <span class="math inline">\(S(t)\)</span> is <span id="eq-hatS"><span class="math display">\[
  \hat{S}(t)
  = \prod_{j: t_j \leq t} \hat{q}_j
  = \prod_{j: t_j \leq t} \bigg(1 - \frac{d_j}{n_j}\bigg).
\tag{6.5}\]</span></span> This is the product of the conditional survival probabilities in <span class="math inline">\((t_{j - 1}, t_j]\)</span> for all intervals such that <span class="math inline">\(t_j \leq t\)</span>. To survive to time <span class="math inline">\(t\)</span>, you need to survive through all intervals up to and including time <span class="math inline">\(t\)</span>. This makes it easier to calculate the survival function than to calculate cumulative incidence directly. The Kaplan-Meier estimator is a consistent and asymptotically normal estimator of the true survival function <span class="citation" data-cites="fleming2005counting aalen2008survival">(<a href="references.html#ref-fleming2005counting" role="doc-biblioref">Fleming and Harrington 2005</a>; <a href="references.html#ref-aalen2008survival" role="doc-biblioref">Aalen, Borgan, and Gjessing 2008</a>)</span>. <a href="#fig-KMcurve" class="quarto-xref">Figure&nbsp;<span>6.1</span></a> shows an example based on a right-censored sample of size 500 from a log-logistic distribution with shape <span class="math inline">\(\alpha = 1\)</span> and rate <span class="math inline">\(\lambda = 2\)</span>.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" aria-current="page">R</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>loglogistic.R</strong></pre>
</div>
<div class="sourceCode" id="cb1" data-filename="loglogistic.R"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Fitting a log-logistic distribution</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># To sample a log-logistic random variable in R, you sample a logistic random</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># variable with location = -log(rate) and scale = 1 / shape.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># The exponential of the logistic variable has a log-logistic distribution</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># with the correct rate and shape parameters.</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Log-logistic distribution and regression (rate = 2, shape = 3)</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>llsample <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">rlogis</span>(<span class="dv">1000</span>, <span class="at">location =</span> <span class="sc">-</span><span class="fu">log</span>(<span class="dv">2</span>), <span class="at">scale =</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">3</span>))</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>llogdat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">time =</span> llsample, <span class="at">event =</span> <span class="dv">1</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>llogreg <span class="ot">&lt;-</span> <span class="fu">survreg</span>(<span class="fu">Surv</span>(time, event) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> llogdat,</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>                   <span class="at">dist =</span> <span class="st">"loglogistic"</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="sc">-</span><span class="fu">coef</span>(llogreg))       <span class="co"># point estimate of rate</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="sc">-</span><span class="fu">confint</span>(llogreg))    <span class="co"># 95% confidence interval for rate</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">/</span> llogreg<span class="sc">$</span>scale         <span class="co"># point estimate of shape</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co"># log-transformed 95% confidence interval for the shape parameter</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="sc">-</span><span class="fu">log</span>(llogreg<span class="sc">$</span>scale) <span class="sc">+</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="sc">*</span> <span class="fu">qnorm</span>(.<span class="dv">975</span>) <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="fu">vcov</span>(llogreg)[<span class="st">"Log(scale)"</span>, <span class="st">"Log(scale)"</span>]))</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co"># plot of true and estimated log-logistic hazard functions</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>llrate_est <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="fu">coef</span>(llogreg))</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>llshape_est <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> llogreg<span class="sc">$</span>scale</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>llrate_true <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>llshape_true <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>h_llog <span class="ot">&lt;-</span> <span class="cf">function</span>(time, rate, shape) {</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># returns last expression if there is no return() statement</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>  (rate <span class="sc">*</span> shape <span class="sc">*</span> (time <span class="sc">*</span> rate)<span class="sc">^</span>(shape <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">/</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>   (<span class="dv">1</span> <span class="sc">+</span> (time<span class="sc">*</span> rate)<span class="sc">^</span>shape))</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">4</span>, <span class="at">by =</span> <span class="fl">0.01</span>)</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(t, <span class="fu">h_llog</span>(t, llrate_true, llshape_true), <span class="at">type =</span> <span class="st">"n"</span>,</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">ylab =</span> <span class="st">"Hazard (Log-logistic)"</span>)</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="fu">grid</span>()</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(t, <span class="fu">h_llog</span>(t, llrate_est, llshape_est))</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(t, <span class="fu">h_llog</span>(t, llrate_true, llshape_true), <span class="at">lty =</span> <span class="st">"dashed"</span>)</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">lty =</span> <span class="fu">c</span>(<span class="st">"solid"</span>, <span class="st">"dashed"</span>), <span class="at">bg =</span> <span class="st">"white"</span>,</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Estimated hazard function"</span>, <span class="st">"True hazard function"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-with-filename">
<details class="code-fold">
<summary>Code</summary>
<div class="code-with-filename-file">
<pre><strong>KMcurve.R</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Kaplan-Meier survival curve</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># right-censored sample from log-logistic dist with rate = 2 and shape = 1</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Uses samples from logistic distribution with location = -log(rate) and</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># scale = 1 / shape.</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>llog_f <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">rlogis</span>(<span class="dv">500</span>, <span class="at">location =</span> <span class="sc">-</span><span class="fu">log</span>(<span class="dv">2</span>), <span class="at">scale =</span> <span class="dv">1</span>))</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>llog_c <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">rlogis</span>(<span class="dv">500</span>, <span class="at">location =</span> <span class="sc">-</span><span class="fu">log</span>(<span class="dv">2</span>), <span class="at">scale =</span> <span class="dv">2</span>))</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">pmin</span>(llog_f, llog_c)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(llog_c <span class="sc">&lt;</span> llog_f, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>llogdat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">time =</span> t, <span class="at">delta =</span> d)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Kaplan-Meier estimate with complementary log-log confidence intervals</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>llog_km <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(time, delta) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> llogdat,</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>                   <span class="at">conf.type =</span> <span class="st">"log-log"</span>)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Log-logistic survival function</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>llog_surv <span class="ot">&lt;-</span> <span class="cf">function</span>(t, <span class="at">lambda=</span><span class="dv">1</span>, <span class="at">gamma=</span><span class="dv">1</span>) <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> (lambda <span class="sc">*</span> t)<span class="sc">^</span>gamma)</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Kaplan-Meier curve and log-logistic survival curve</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fu">max</span>(llogdat<span class="sc">$</span>time), .<span class="dv">01</span>)</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(llog_km, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">15</span>),</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">ylab =</span> <span class="st">"Survival probability"</span>)</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="fu">grid</span>()</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(t, <span class="fu">llog_surv</span>(t, <span class="dv">2</span>, <span class="dv">1</span>), <span class="at">col =</span> <span class="st">"darkgray"</span>)</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">bg =</span> <span class="st">"white"</span>,</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">lty =</span> <span class="fu">c</span>(<span class="st">"solid"</span>, <span class="st">"dashed"</span>, <span class="st">"solid"</span>),</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"black"</span>, <span class="st">"darkgray"</span>),</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Kaplan-Meier estimate"</span>, <span class="st">"95% confidence limits"</span>,</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"True survival function"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell-output-display">
<div id="fig-KMcurve" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-KMcurve-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="survival_files/figure-html/fig-KMcurve-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="Figure&nbsp;6.1: True log-logistic survival function and Kaplan-Meier estimate with complementary log-log 95% confidence limits."><img src="survival_files/figure-html/fig-KMcurve-1.png" class="img-fluid figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-KMcurve-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6.1: True log-logistic survival function and Kaplan-Meier estimate with complementary log-log 95% confidence limits.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="greenwood-formula-and-confidence-intervals" class="level3" data-number="6.2.3">
<h3 data-number="6.2.3" class="anchored" data-anchor-id="greenwood-formula-and-confidence-intervals"><span class="header-section-number">6.2.3</span> Greenwood formula and confidence intervals</h3>
<p>Calculating the variance of a product is difficult and tedious, but calculating the variance of a sum is easy. Taking logarithms in <a href="#eq-hatS" class="quarto-xref">Equation&nbsp;<span>6.5</span></a>, we get <span class="math display">\[
  \ln \hat{S}(t) = \sum_{j: t_j \leq t} \ln \hat{q}_j.
\]</span> For each <span class="math inline">\(j\)</span>, the estimated variance of <span class="math inline">\(\hat{q}_j\)</span> is <span class="math display">\[
  \Var(\hat{q}_j) = \frac{1}{n_j}\hat{q}_j \big(1 - \hat{q}_j\big).
\]</span> Since <span class="math inline">\(\ln x\)</span> has the derivative <span class="math inline">\(\frac{1}{x}\)</span>, <span class="math display">\[
    \Var(\ln \hat{q}_j)
    \approx \frac{1}{\hat{q}_j^2} \Var\big(\hat{q}_j\big)
    = \frac{d_j}{n_j(n_j - d_j)}.
\]</span> by the delta method from <a href="mlestimation.html#sec-delta" class="quarto-xref"><span>Section 3.4.1</span></a>.</p>
<p>The estimated survival probabilities in each time interval are conditionally independent, so <span class="math display">\[
  \Var\bigl(\ln \hat{S}(t)\bigr)
  = \sum_{t_j \leq t} \Var(\ln \hat{q}_j)
  = \sum_{t_j \leq t} \frac{d_j}{n_j(n_j - d_j)}.
\]</span> by <a href="probability.html#eq-lincomV" class="quarto-xref">Equation&nbsp;<span>1.12</span></a>. Since <span class="math inline">\(\hat{S}(t) = \exp\big(\ln \hat{S}(t)\big)\)</span>, we can use the delta method again to get an estimated variance for <span class="math inline">\(\hat{S}(t)\)</span>. The function <span class="math inline">\(\exp(x) = e^x\)</span> is its own derivative, so we get <span id="eq-Greenwood"><span class="math display">\[
  \Var\bigl(\hat{S}(t)\bigr)
  = \hat{S}(t)^2 \Var\bigl(\ln \hat{S}(t)\bigr)
  = \hat{S}(t)^2 \sum_{t_j \leq t} \frac{d_j}{n_j(n_j - d_j)}.
\tag{6.6}\]</span></span> This is called the <em>Greenwood formula</em> <span class="citation" data-cites="greenwood1926report">(<a href="references.html#ref-greenwood1926report" role="doc-biblioref">Greenwood 1926</a>)</span>.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> It was developed originally for life tables and applied later to the Kaplan-Meier estimator.</p>
<p>For each <span class="math inline">\(t\)</span>, a pointwise Wald <span class="math inline">\(95\%\)</span> confidence interval for <span class="math inline">\(S(t)\)</span> is <span class="math display">\[
  \hat{S}(t) \pm 1.96 \sqrt{\Var\bigl(\hat{S}(t)\bigr)}.
\]</span> This confidence interval can have a lower bound less than zero or an upper bound greater than one, outside the possible values of <span class="math inline">\(S(t)\)</span>. Better confidence intervals can be obtained using a <em>complementary log-log</em> transformation, which is <span class="math display">\[
  \ln\bigl(-\ln S(t)\bigr) = \ln H(t)
\]</span> where <span class="math inline">\(H(t)\)</span> is the cumulative hazard. The logit (log odds) transformation can also be used.</p>
</section>
<section id="cumulative-incidence-and-cumulative-hazard" class="level3" data-number="6.2.4">
<h3 data-number="6.2.4" class="anchored" data-anchor-id="cumulative-incidence-and-cumulative-hazard"><span class="header-section-number">6.2.4</span> Cumulative incidence and cumulative hazard</h3>
<p>The Kaplan-Meier estimator of the survival function can also be used to estimate the cumulative hazard function <span class="math inline">\(H(t) = -\ln S(t)\)</span> and the cumulative incidence function <span class="math inline">\(F(t) = 1 - S(t)\)</span>, which is the CDF of the time-to-event distribution. The estimated cumulative hazard function is <span id="eq-hatHkm"><span class="math display">\[
  \hat{H}_\text{KM}(t)
  = -\ln \hat{S}(t),
\tag{6.7}\]</span></span> which is defined whenever <span class="math inline">\(\hat{S}(t) &gt; 0\)</span>. The estimated cumulative incidence function is <span class="math display">\[
  \hat{F}_\text{KM}(t)
  = 1 - \hat{S}(t).
\]</span> When there is no right censoring or left truncation (delayed entry), <span class="math inline">\(\hat{F}(t)\)</span> equals the empirical CDF of the times to events as in <a href="#eq-hatF" class="quarto-xref">Equation&nbsp;<span>6.1</span></a> and the Greenwood variance equals the corresponding variance in <a href="#eq-hatFvar" class="quarto-xref">Equation&nbsp;<span>6.2</span></a>. Confidence limits for <span class="math inline">\(F(t)\)</span> or <span class="math inline">\(H(t)\)</span> can be obtained from the corresponding confidence limits for <span class="math inline">\(S(t)\)</span>.</p>
</section>
</section>
<section id="sec-NA" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="sec-NA"><span class="header-section-number">6.3</span> Nelson-Aalen estimator</h2>
<p>The Kaplan-Meier estimator is based on estimating conditional survival probabilities in intervals within which there are no entries or exits. The <strong>Nelson-Aalen</strong> esimator uses the same time intervals, but it estimates an expected number of events in each interval <span class="citation" data-cites="nelson1969hazard nelson1972theory altshuler1970theory aalen1978nonparametric">(<a href="references.html#ref-nelson1969hazard" role="doc-biblioref">Nelson 1969</a>, <a href="references.html#ref-nelson1972theory" role="doc-biblioref">1972</a>; <a href="references.html#ref-altshuler1970theory" role="doc-biblioref">Altshuler 1970</a>; <a href="references.html#ref-aalen1978nonparametric" role="doc-biblioref">Aalen 1978</a>)</span>. It is based on the interpretation of the cumulative hazard <span class="math inline">\(H(t)\)</span> as an expected number of events in <span class="math inline">\((0, t]\)</span> if the event could be made repeatable, and it uses the fact that the expected number of events in different intervals can be added together by <a href="probability.html#eq-lincomE" class="quarto-xref">Equation&nbsp;<span>1.11</span></a>. The at-risk process and risk sets are defined exactly as in <a href="#sec-risksets" class="quarto-xref"><span>Section 6.2.1</span></a>.</p>
<section id="sec-FH" class="level3" data-number="6.3.1">
<h3 data-number="6.3.1" class="anchored" data-anchor-id="sec-FH"><span class="header-section-number">6.3.1</span> Cumulative hazard via addition of expected values</h3>
<p>As above, let <span class="math inline">\(0 = t_0 &lt; t_1 &lt; t_2 &lt; \ldots &lt; t_m\)</span> be the endpoints of intervals <span class="math inline">\((t_{i-1}, t_i]\)</span> within which there are no entries or exits from the study. Let <span class="math inline">\(n_j = \sum_{i = 1}^n Y_i(t_j)\)</span> be the number of people in the risk set <span class="math inline">\(\mathcal{R}(t_j)\)</span> and let <span class="math inline">\(d_j \geq 0\)</span> be the number of failures that occur at time <span class="math inline">\(t_j\)</span>. The estimated expected number of events per individual under observation in this time interval is <span class="math display">\[
  \frac{1}{n_j} \sum_{i \in \mathcal{R}_j} \indicator_{\tevent_i \in (t_{j - 1}, t_j]}
  = \frac{d_j}{n_j}.
\]</span> Adding these up over all time intervals with endpoints at or before time <span class="math inline">\(t\)</span>, we get the Nelson-Aalen estimator <span id="eq-hatH"><span class="math display">\[
  \hat{H}(t)
  = \sum_{j: t_j \leq t} \frac{d_j}{n_j}.
\tag{6.8}\]</span></span> The Nelson-Aalen estimator is an unbiased, consistent, and asymptotically normal estimator of the true cumulative hazard <span class="citation" data-cites="fleming2005counting aalen2008survival">(<a href="references.html#ref-fleming2005counting" role="doc-biblioref">Fleming and Harrington 2005</a>; <a href="references.html#ref-aalen2008survival" role="doc-biblioref">Aalen, Borgan, and Gjessing 2008</a>)</span>. <a href="#fig-NAcurve" class="quarto-xref">Figure&nbsp;<span>6.2</span></a> shows an example based on a right-censored sample of size 500 from a log-logistic distribution with shape <span class="math inline">\(\alpha = 1\)</span> and rate <span class="math inline">\(\lambda = 2\)</span>.</p>
<p>The <strong>Fleming-Harrington correction for ties</strong> <span class="citation" data-cites="fleming1984nonparametric">(<a href="references.html#ref-fleming1984nonparametric" role="doc-biblioref">Fleming and Harrington 1984</a>)</span> replaces each <span class="math inline">\(d_j / n_j\)</span> in <a href="#eq-hatH" class="quarto-xref">Equation&nbsp;<span>6.8</span></a> with <span id="eq-FHcorrection"><span class="math display">\[
  \frac{1}{n_j} + \frac{1}{n_j - 1} + \cdots + \frac{1}{n_j - (d_j - 1)}
  &gt; \frac{d_j}{n_j}.
\tag{6.9}\]</span></span> The resulting estimator of the cumulative hazard is sometimes called the <em>Fleming-Harrington estimator</em>. It accounts for the fact that the <span class="math inline">\(d_j\)</span> events did not really happen at the same time. They appear to be tied because the times were defined and measured with the limited precision possible in a real study. The example in <a href="#fig-NAcurve" class="quarto-xref">Figure&nbsp;<span>6.2</span></a> uses this correction.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">R</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>NelsonAalen.R</strong></pre>
</div>
<div class="sourceCode" id="cb3" data-filename="NelsonAalen.R"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Nelson-Aalen estimator</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The Nelson-Aalen estimator is calculated using survival::survfit().</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the argument "stype = 2" to get the survival function estimated from the</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Nelson-Aalen estimate of the cumulative hazard.</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the argument "ctype = 2" to get the Fleming-Harrington correction.</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>?survfit          <span class="co"># get general help about survfit</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>?survfit.formula  <span class="co"># get help with the specific version we use below</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co"># right-censored sample from log-logistic dist with rate = 2 and shape = 1</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Uses samples from logistic distribution with location = -log(rate) and</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co"># scale = 1 / shape.</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>llog_f <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">rlogis</span>(<span class="dv">500</span>, <span class="at">location =</span> <span class="sc">-</span><span class="fu">log</span>(<span class="dv">2</span>), <span class="at">scale =</span> <span class="dv">1</span>))</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>llog_c <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">rlogis</span>(<span class="dv">500</span>, <span class="at">location =</span> <span class="sc">-</span><span class="fu">log</span>(<span class="dv">2</span>), <span class="at">scale =</span> <span class="dv">2</span>))</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">pmin</span>(llog_f, llog_c)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(llog_c <span class="sc">&lt;</span> llog_f, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>llogdat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">time =</span> t, <span class="at">delta =</span> d)</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Nelson-Aalen estimator with log-transformed confidence intervals</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="co"># The log transformation of H is the log-log transformation of S, so we use</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="co"># the argument conf.type = "log-log".</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>llog_na <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(time, delta) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> llogdat,</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>                   <span class="at">conf.type =</span> <span class="st">"log-log"</span>, <span class="at">stype =</span> <span class="dv">2</span>, <span class="at">ctype =</span> <span class="dv">2</span>)</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="co"># point and interval estimates of the survival function</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(llog_na, <span class="at">times =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>)</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate point and interval estimates of the cumulative hazard function</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(<span class="fu">summary</span>(llog_na, <span class="at">times =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>))</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(llog_na, <span class="at">times =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>)<span class="sc">$</span>cumhaz</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fu">log</span>(<span class="fu">summary</span>(llog_na, <span class="at">times =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>)<span class="sc">$</span>surv)</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fu">log</span>(<span class="fu">summary</span>(llog_na, <span class="at">times =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>)<span class="sc">$</span>lower)</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fu">log</span>(<span class="fu">summary</span>(llog_na, <span class="at">times =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>)<span class="sc">$</span>upper)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-with-filename">
<details class="code-fold">
<summary>Code</summary>
<div class="code-with-filename-file">
<pre><strong>NAcurve.R</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Nelson-Aalen cumulative hazard curve</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># right-censored sample from log-logistic dist with rate = 2 and shape = 1</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Uses samples from logistic distribution with location = -log(rate) and</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># scale = 1 / shape.</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>llog_f <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">rlogis</span>(<span class="dv">500</span>, <span class="at">location =</span> <span class="sc">-</span><span class="fu">log</span>(<span class="dv">2</span>), <span class="at">scale =</span> <span class="dv">1</span>))</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>llog_c <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">rlogis</span>(<span class="dv">500</span>, <span class="at">location =</span> <span class="sc">-</span><span class="fu">log</span>(<span class="dv">2</span>), <span class="at">scale =</span> <span class="dv">2</span>))</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">pmin</span>(llog_f, llog_c)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(llog_c <span class="sc">&lt;</span> llog_f, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>llogdat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">time =</span> t, <span class="at">delta =</span> d)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Nelson-Aalen estimate of the survival function with FH correction</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>llog_na <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(time, delta) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> llogdat,</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>                   <span class="at">conf.type =</span> <span class="st">"log-log"</span>, <span class="at">stype =</span> <span class="dv">2</span>, <span class="at">ctype =</span> <span class="dv">2</span>)</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="co"># log-logistic cumulative hazard function</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>llog_cumhaz <span class="ot">&lt;-</span> <span class="cf">function</span>(t, lambda, gamma) <span class="fu">log</span>(<span class="dv">1</span> <span class="sc">+</span> (lambda <span class="sc">*</span> t)<span class="sc">^</span>gamma)</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Nelson-Aalen curve and log-logistic cumulative hazard curve</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fu">max</span>(llogdat<span class="sc">$</span>time), .<span class="dv">01</span>)</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(llog_na, <span class="at">fun =</span> <span class="st">"cumhaz"</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">20</span>),</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">ylab =</span> <span class="st">"Cumulative hazard"</span>)</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="fu">grid</span>()</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(t, <span class="fu">llog_cumhaz</span>(t, <span class="dv">2</span>, <span class="dv">1</span>), <span class="at">col =</span> <span class="st">"darkgray"</span>)</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"bottomright"</span>, <span class="at">bg =</span> <span class="st">"white"</span>, <span class="at">lty =</span> <span class="fu">c</span>(<span class="st">"solid"</span>, <span class="st">"dashed"</span>, <span class="st">"solid"</span>),</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"black"</span>, <span class="st">"darkgray"</span>),</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Nelson-Aalen estimate"</span>, <span class="st">"95% confidence limits"</span>,</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"True cumulative hazard function"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell-output-display">
<div id="fig-NAcurve" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-NAcurve-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="survival_files/figure-html/fig-NAcurve-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2" title="Figure&nbsp;6.2: True log-logistic cumulative hazard function and Nelson-Aalen estimate with log-transformed 95% confidence limits."><img src="survival_files/figure-html/fig-NAcurve-1.png" class="img-fluid figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-NAcurve-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6.2: True log-logistic cumulative hazard function and Nelson-Aalen estimate with log-transformed 95% confidence limits.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="variance-and-confidence-intervals" class="level3" data-number="6.3.2">
<h3 data-number="6.3.2" class="anchored" data-anchor-id="variance-and-confidence-intervals"><span class="header-section-number">6.3.2</span> Variance and confidence intervals</h3>
<p>Let <span class="math inline">\(D_j\)</span> be the random number of events in the interval <span class="math inline">\((t_{j - 1}, t_j]\)</span> whose observed value is <span class="math inline">\(d_j\)</span>. If an event is repeatable, the number of events per individual in any interval <span class="math inline">\((t_{j - 1}, t_j]\)</span> has a Poisson distribution with mean <span class="math display">\[
  \Delta H_j
  = H(t_j) - H(t_{j - 1}).
\]</span> When an event cannot be repeated, this is true in an interval sufficiently small that <span class="math inline">\(\Delta H_j\)</span> is much smaller than one (i.e., <span class="math inline">\(\Delta H_j \ll 1\)</span>). Because our time intervals are defined to be small enough that no one leaves the study by having an event, <span class="math inline">\(\Delta H_j \ll 1\)</span> in each interval where <span class="math inline">\(n_j\)</span> is large.</p>
<p>Because we have <span class="math inline">\(n_j\)</span> individuals at risk in this interval, <span class="math display">\[
  D_j \sim \text{Poisson}(n_j \Delta H_j).
\]</span> because <span class="math inline">\(D_j\)</span> is the sum of <span class="math inline">\(n_j\)</span> Poisson(<span class="math inline">\(\Delta H_j\)</span>) random variables. Because <span class="math inline">\(\Var(D_j) = n_j \Delta H_j\)</span>, <span class="math display">\[
  \Var\biggl(\frac{D_j}{n_j}\biggr)
  = \frac{1}{n_j^2} \Var(D_j)
  = \frac{\Delta H_j}{n_j}.
\]</span> Replacing the unknown <span class="math inline">\(\Delta H_j\)</span> with <span class="math display">\[
  \Delta \hat{H}_j
  = \hat{H}(t_j) - \hat{H}(t_{j - 1})
  = \frac{d_j}{n_j},
\]</span> we get the estimated variance <span class="math display">\[
  \Var\bigl(\Delta \hat{H}_j\bigr)
  = \frac{d_j}{n_j^2}.
\]</span> The variance of <span class="math inline">\(\hat{H}(t)\)</span> is the sum of these variances over all time intervals with endpoints on or before time <span class="math inline">\(t\)</span>, so <span class="math display">\[
  \Var\bigl(\hat{H}(t)\bigr)
  = \sum_{j: t_j \leq t} \Var\bigl(\Delta \hat{H}_j\bigr)
  = \sum_{j: t_j \leq t} \frac{d_j}{n_j^2}.
\]</span> With the Fleming-Harrington correction for ties from <a href="#eq-FHcorrection" class="quarto-xref">Equation&nbsp;<span>6.9</span></a>, each <span class="math inline">\(d_j / n_j^2\)</span> is replaced by <span class="math display">\[
  \frac{1}{n_j^2} + \frac{1}{(n_j - 1)^2} + \cdots + \frac{1}{\big(n_j - (d_j - 1)\big)^2}
  &gt; \frac{d_j}{n_j^2}.
\]</span> This estimator of the variance (with or without the Fleming-Harrington correction) can be justified more rigorously using the theory of <em>counting processes</em> and <em>martingales</em> <span class="citation" data-cites="fleming2005counting aalen2008survival">(<a href="references.html#ref-fleming2005counting" role="doc-biblioref">Fleming and Harrington 2005</a>; <a href="references.html#ref-aalen2008survival" role="doc-biblioref">Aalen, Borgan, and Gjessing 2008</a>)</span>. For our purposes, it is enough to highlight its connection to the Poisson distribution.</p>
<p>For each <span class="math inline">\(t\)</span>, a pointwise Wald 95% confidence interval for <span class="math inline">\(H(t)\)</span> is <span class="math display">\[
  \hat{H}(t) \pm 1.96 \sqrt{\Var\bigl(\hat{H}(t)\bigr)}.
\]</span> This can produce confidence intervals with negative lower bounds, outside the possible values of <span class="math inline">\(H(t)\)</span>. A better confidence interval is produced using a log transformation. By the delta method, <span class="math display">\[
  \Var\bigl(\ln \hat{H}(t)\bigr) = \frac{1}{\hat{H}(t)^2} \Var\bigl(\hat{H}(t)\bigr).
\]</span> The corresponding confidence interval for <span class="math inline">\(\hat{H}(t)\)</span> has the endpoints <span id="eq-logHci"><span class="math display">\[
  \hat{H}(t) e^{\pm 1.96 \sqrt{\Var\bigl(\ln \hat{H}(t)\bigr)}}.
\tag{6.10}\]</span></span> Both endpoints of this confidence interval are nonnegative, and they are strictly positive for all <span class="math inline">\(t\)</span> such that <span class="math inline">\(\hat{H}(t) &gt; 0\)</span>. Because <span class="math inline">\(H(t) = -\ln S(t)\)</span>, the log transformation for the cumulative hazard function <span class="math inline">\(H(t)\)</span> corresponds to the log-log transformation for the survival function <span class="math inline">\(S(t)\)</span>.</p>
</section>
<section id="survival-and-cumulative-incidence-functions" class="level3" data-number="6.3.3">
<h3 data-number="6.3.3" class="anchored" data-anchor-id="survival-and-cumulative-incidence-functions"><span class="header-section-number">6.3.3</span> Survival and cumulative incidence functions</h3>
<p>The Nelson-Aalen estimate <span class="math inline">\(\hat{H}(t)\)</span> can be used to estimate the survival function <span class="math display">\[
S(t) = e^{-H(t)},
\]</span> and the cumulative incidence function <span class="math display">\[
  F(t) = 1 - S(t) = 1 - e^{-H(t)}.
\]</span> The estimated survival function is <span class="math display">\[
  \hat{S}_\text{NA}(t) = e^{-\hat{H}(t)},
\]</span> and the estimated cumulative incidence function is <span class="math display">\[
  \hat{F}_\text{NA}(t) = 1 - \hat{S}_\text{NA}(t) = 1 - e^{-\hat{H}(t)}.
\]</span> In both of these estimators, <span class="math inline">\(\hat{H}(t)\)</span> can incorporate the Fleming-Harrington correction for ties from <a href="#eq-FHcorrection" class="quarto-xref">Equation&nbsp;<span>6.9</span></a>. Confidence limits for <span class="math inline">\(S(t)\)</span> and <span class="math inline">\(F(t)\)</span> can be obtained from the corresponding confidence limits for <span class="math inline">\(H(t)\)</span>.</p>
<p>If there is any <span class="math inline">\(t_j\)</span> where all individuals at risk have an event, the Kaplan-Meier estimator <span class="math inline">\(\hat{S}(t) = 0\)</span> for all <span class="math inline">\(t &gt; t_j\)</span>. Once you multiply by zero, there is no going back. This never happens for the estimate of <span class="math inline">\(S(t)\)</span> based on the Nelson-Aalen estimator. Because <span class="math inline">\(\hat{H}(t) &lt; \infty\)</span>, we always have <span class="math display">\[
  \hat{S}_\text{NA}(t) = \exp\bigl(-\hat{H}(t)\bigr) &gt; 0.
\]</span> This is a practical advantage of the Nelson-Aalen estimator over the Kaplan-Meier estimator.</p>
<p>More generally, the Kaplan-Meier estimator produces smaller estimates of <span class="math inline">\(S(t)\)</span> than the Nelson-Aalen estimator does. Similar inequalities exist for the estimated <span class="math inline">\(H(t)\)</span> and <span class="math inline">\(F(t)\)</span>: <span class="math display">\[
  \begin{aligned}
    \hat{S}(t)            &amp;\leq \hat{S}_\text{NA}(t) \\
    \hat{H}_\text{KM}(t)  &amp;\geq \hat{H}(t) \\
    \hat{F}_{KM}(t)       &amp;\geq \hat{F}_\text{NA}(t).
  \end{aligned}
\]</span> Each inequality implies the others, but the cumulative hazard inequality is the simplest. As shown in <a href="#fig-Hineq" class="quarto-xref">Figure&nbsp;<span>6.3</span></a>, <span class="math display">\[
  -\ln\biggl(1 - \frac{d_j}{n_j}\biggr)
  \geq \frac{d_j}{n_j}
\]</span> with equality only if <span class="math inline">\(d_j &gt; 0\)</span>. By <a href="#eq-hatS" class="quarto-xref">Equation&nbsp;<span>6.5</span></a> and <a href="#eq-hatHkm" class="quarto-xref">Equation&nbsp;<span>6.7</span></a>, <span class="math display">\[
  \hat{H}_{KM}(t)
  = -\sum_{j: t_j \leq t} \ln\biggl(1 - \frac{d_j}{n_j}\biggr)
  \geq \sum_{j: t_j \leq t} \frac{d_j}{n_j}
  = \hat{H}(t).
\]</span> with equality only when all <span class="math inline">\(d_j = 0\)</span> in the sums. The Nelson-Aalen estimate with the Fleming-Harrington correction for ties is greater than the uncorrected <span class="math inline">\(\hat{H}(t)\)</span> and less than <span class="math inline">\(\hat{H}_\text{KM}(t)\)</span>. Although not equal, the Nelson-Aalen estimator and Kaplan-Meier estimators of the survival <span class="math inline">\(S(t)\)</span>, cumulative hazard <span class="math inline">\(H(t)\)</span>, and the cumulative incidence <span class="math inline">\(F(t)\)</span> produce similar results in large samples, where <span class="math inline">\(d_j / n_j\)</span> is small for each <span class="math inline">\(j\)</span>.</p>
<div class="cell">
<div class="code-with-filename">
<details class="code-fold">
<summary>Code</summary>
<div class="code-with-filename-file">
<pre><strong>estHineq.R</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Kaplan-Meier H(t) &gt;= Nelson-Aalen H(t)</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># plot of estimated cumulative hazard function increments</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.01</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, x, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="fu">expression</span>(d[j] <span class="sc">/</span> n[j]),</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"Estimated "</span>, Delta, H[j], <span class="st">" = "</span>,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">H</span>(t[j]) <span class="sc">-</span> <span class="fu">H</span>(t[j <span class="sc">-</span> <span class="dv">1</span>]))))</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, <span class="sc">-</span><span class="fu">log</span>(<span class="dv">1</span> <span class="sc">-</span> x), <span class="at">lty =</span> <span class="st">"dashed"</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="fu">grid</span>()</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="fl">0.75</span>, <span class="fl">0.55</span>, <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"NA estimator: "</span>, d[j] <span class="sc">/</span> n[j])))</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="fl">0.25</span>, <span class="fl">0.7</span>, <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"KM estimator: -ln("</span>, <span class="dv">1</span> <span class="sc">-</span> d[j] <span class="sc">/</span> n[j], <span class="st">")"</span>,</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">sep =</span> <span class="st">""</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell-output-display">
<div id="fig-Hineq" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-Hineq-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="survival_files/figure-html/fig-Hineq-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3" title="Figure&nbsp;6.3: Increments in the estimated cumulative hazard in the interval (t_{j - 1}, t_j] based on the Kaplan-Meier and Nelson-Aalen estimators."><img src="survival_files/figure-html/fig-Hineq-1.png" class="img-fluid figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-Hineq-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6.3: Increments in the estimated cumulative hazard in the interval <span class="math inline">\((t_{j - 1}, t_j]\)</span> based on the Kaplan-Meier and Nelson-Aalen estimators.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="parametric-failure-time-distributions" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="parametric-failure-time-distributions"><span class="header-section-number">6.4</span> Parametric failure time distributions</h2>
<p>Many times to events that are important in epidemiology cannot be accurately described using an exponential distribution. In particular, it is important to allow the hazard function <span class="math inline">\(h(t)\)</span> to change over time. Here, we introduce two simple failure time distributions where <span class="math inline">\(h(t)\)</span> is not constant. They each have a shape parameter <span class="math inline">\(\alpha\)</span> and a rate parameter <span class="math inline">\(\lambda\)</span>. As with the exponential distribution, the scale parameter is <span class="math inline">\(\sigma = 1 / \lambda\)</span>. The gamma distribution from equation <a href="longitudinal.html#eq-gammaPDF" class="quarto-xref">Equation&nbsp;<span>5.19</span></a> is also used as a failure time distribution, but its survival and hazard functions do not have a simple closed form.</p>
<p>For all parametric failure time models, likelihoods are constructed as in <a href="longitudinal.html#sec-survlik" class="quarto-xref"><span>Section 5.2.4</span></a>. The rate parameter <span class="math inline">\(\lambda\)</span> and shape parameter <span class="math inline">\(\alpha\)</span> can be estimated using frequentist methods such as maximum likelihood or Bayesian methods. When using parametric methods, it is important to evaluate goodness-of-fit to check whether the underlying assumptions are reasonable.</p>
<section id="weibull-distribution" class="level3" data-number="6.4.1">
<h3 data-number="6.4.1" class="anchored" data-anchor-id="weibull-distribution"><span class="header-section-number">6.4.1</span> Weibull distribution</h3>
<p>The Weibull distribution <span class="citation" data-cites="weibull1951statistical">(<a href="references.html#ref-weibull1951statistical" role="doc-biblioref">Weibull et al. 1951</a>)</span> is a two-parameter generalization of the exponential distribution.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a> It has the survival function <span class="math display">\[
  S(t, \alpha, \lambda) = \exp\big(-(\lambda t)^\alpha\big),
\]</span> where <span class="math inline">\(\alpha &gt; 0\)</span> is the shape parameter and <span class="math inline">\(\lambda &gt; 0\)</span> is the rate parameter. The Weibull cumulative hazard function is <span id="eq-weibH"><span class="math display">\[
  H(t, \alpha, \lambda) = -\ln S(t) = (\lambda t)^\alpha,
\tag{6.11}\]</span></span> and its hazard function is <span id="eq-weibhaz"><span class="math display">\[
  h(t, \alpha, \lambda)
  = \frac{\partial}{\partial t} H(t, \alpha, \lambda)
  = \alpha \lambda^\alpha t^{\alpha - 1}.
\tag{6.12}\]</span></span> The notation <span class="math inline">\(\partial / \partial t\)</span> means that we take a derivative with respect to <span class="math inline">\(t\)</span> while holding the other arguments, <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\lambda\)</span>, constant. <a href="#fig-hweib" class="quarto-xref">Figure&nbsp;<span>6.4</span></a> shows examples of these hazard functions. The exponential distribution is a special case of the Weibull distribution with shape <span class="math inline">\(\alpha = 1\)</span>.</p>
<div class="cell">
<div class="code-with-filename">
<details class="code-fold">
<summary>Code</summary>
<div class="code-with-filename-file">
<pre><strong>Weibull-haz.R</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Weibull hazard functions</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># hazard function</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>hweib <span class="ot">&lt;-</span> <span class="cf">function</span>(t, <span class="at">shape=</span><span class="dv">1</span>, <span class="at">rate=</span><span class="dv">1</span>) shape <span class="sc">*</span> rate<span class="sc">^</span>shape <span class="sc">*</span> t<span class="sc">^</span>(shape <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># hazard plots for shapes 2, 1, and 1 / 2</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="at">by =</span> <span class="fl">0.01</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(t, <span class="fu">hweib</span>(t, <span class="dv">2</span>), <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">lty =</span> <span class="st">"dashed"</span>,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">ylab =</span> <span class="st">"Weibull hazard (rate = 1)"</span>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(t, <span class="fu">hweib</span>(t))</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(t, <span class="fu">hweib</span>(t, <span class="fl">0.5</span>), <span class="at">lty =</span> <span class="st">"dotted"</span>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="fu">grid</span>()</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="fl">1.6</span>, <span class="fl">1.2</span>, <span class="st">"shape = 1 (exponential)"</span>)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="fl">1.25</span>, <span class="fl">0.2</span>, <span class="st">"shape = 1 / 2"</span>)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="fl">0.7</span>, <span class="fl">1.9</span>, <span class="st">"shape = 2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell-output-display">
<div id="fig-hweib" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-hweib-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="survival_files/figure-html/fig-hweib-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4" title="Figure&nbsp;6.4: Hazard functions for the Weibull distribution with different shape parameters \alpha. All have rate \lambda = 1."><img src="survival_files/figure-html/fig-hweib-1.png" class="img-fluid figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-hweib-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6.4: Hazard functions for the Weibull distribution with different shape parameters <span class="math inline">\(\alpha\)</span>. All have rate <span class="math inline">\(\lambda = 1\)</span>.
</figcaption>
</figure>
</div>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">R</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Weibull.R</strong></pre>
</div>
<div class="sourceCode" id="cb7" data-filename="Weibull.R"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Fitting a Weibull distribution</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># In R, the shape is 1 / the "scale" parameter.</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># In standard terminology, the scale is 1 / rate.</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Weibull distribution and regression (rate = 2, shape = 3)</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Weibull is the default distribution for survival::survreg().</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>wsample <span class="ot">&lt;-</span> <span class="fu">rweibull</span>(<span class="dv">1000</span>, <span class="at">shape =</span> <span class="dv">3</span>, <span class="at">scale =</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>weibdat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">time =</span> wsample, <span class="at">event =</span> <span class="dv">1</span>)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>weibreg <span class="ot">&lt;-</span> <span class="fu">survreg</span>(<span class="fu">Surv</span>(time, event) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> weibdat)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(weibreg)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="sc">-</span><span class="fu">coef</span>(weibreg))       <span class="co"># point estimate of rate</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="sc">-</span><span class="fu">confint</span>(weibreg))    <span class="co"># 95% confidence interval for rate</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">/</span> weibreg<span class="sc">$</span>scale         <span class="co"># point estimate of shape</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co"># log-transformed Wald confidence interval for the shape parameter</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="co"># vcov() returns the estimated covariance matrix from the model</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="sc">-</span><span class="fu">log</span>(weibreg<span class="sc">$</span>scale) <span class="sc">+</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    <span class="sc">*</span> <span class="fu">qnorm</span>(.<span class="dv">975</span>) <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="fu">vcov</span>(weibreg)[<span class="st">"Log(scale)"</span>, <span class="st">"Log(scale)"</span>]))</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="co"># plot of true and estimated Weibull hazard functions</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>wrate_est <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="fu">coef</span>(weibreg))</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>wshape_est <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> weibreg<span class="sc">$</span>scale</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>wrate_true <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>wshape_true <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>h_weib <span class="ot">&lt;-</span> <span class="cf">function</span>(time, rate, shape) rate <span class="sc">*</span> shape <span class="sc">*</span> (time <span class="sc">*</span> rate)<span class="sc">^</span>(shape <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">4</span>, <span class="at">by =</span> <span class="fl">0.01</span>)</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(t, <span class="fu">h_weib</span>(t, wrate_true, wshape_true), <span class="at">type =</span> <span class="st">"n"</span>,</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">ylab =</span> <span class="st">"Hazard (Weibull)"</span>)</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a><span class="fu">grid</span>()</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(t, <span class="fu">h_weib</span>(t, wrate_est, wshape_est))</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(t, <span class="fu">h_weib</span>(t, wrate_true, wshape_true), <span class="at">lty =</span> <span class="st">"dashed"</span>)</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="at">lty =</span> <span class="fu">c</span>(<span class="st">"solid"</span>, <span class="st">"dashed"</span>), <span class="at">bg =</span> <span class="st">"white"</span>,</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Estimated hazard function"</span>, <span class="st">"True hazard function"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="log-logistic-distribution" class="level3" data-number="6.4.2">
<h3 data-number="6.4.2" class="anchored" data-anchor-id="log-logistic-distribution"><span class="header-section-number">6.4.2</span> Log-logistic distribution</h3>
<p>The exponential distribution has a constant hazard, and the Weibull hazard function is increasing, decreasing, or constant. The log-logistic distribution has a more flexible hazard function. Its survival function is <span class="math display">\[
  S(t) = \frac{1}{1 + (\lambda t)^\alpha}.
\]</span> where <span class="math inline">\(\lambda &gt; 0\)</span> is the rate pameter and <span class="math inline">\(\alpha &gt; 0\)</span> is the shape parameter. Its cumulative hazard function is <span class="math display">\[
  H(t, \alpha, \lambda) = -\ln S(t) = \ln \big(1 + (\lambda t)^\alpha\big),
\]</span> and its the hazard function is <span class="math display">\[
  h(t, \alpha, \lambda)
  = \frac{\partial}{\partial t} H(t, \alpha, \lambda)
  = \frac{\lambda \alpha (\lambda t)^{\alpha - 1}}{1 + (\lambda t)^\alpha}.
\]</span> As before, we differentiate <span class="math inline">\(H(t, \alpha, \lambda)\)</span> with respect to <span class="math inline">\(t\)</span> while holding <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\lambda\)</span> constant. There are three general shapes that the hazard function can take depending on the shape parameter <span class="math inline">\(\alpha\)</span>: <span class="math display">\[
  h(t)
  \begin{cases}
      \text{decreases from } \infty &amp;\text{if } \alpha  &lt; 1, \\
      \text{decreases from } \lambda &amp;\text{if } \alpha = 1, \\
      \text{increases then decreases} &amp;\text{if } \alpha &gt; 1.
  \end{cases}
\]</span> <a href="#fig-hllog" class="quarto-xref">Figure&nbsp;<span>6.5</span></a> shows examples of these hazard functions. The exponential distribution is not a special case of the log-logistic distribution for any shape <span class="math inline">\(\alpha\)</span>.</p>
<div class="cell">
<div class="code-with-filename">
<details class="code-fold">
<summary>Code</summary>
<div class="code-with-filename-file">
<pre><strong>loglogistic-haz.R</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Log-logistic hazard function plot</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># hazard function</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>hllog <span class="ot">&lt;-</span> <span class="cf">function</span>(t, <span class="at">shape=</span><span class="dv">1</span>, <span class="at">rate=</span><span class="dv">1</span>) {</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  shape <span class="sc">*</span> rate<span class="sc">^</span>shape <span class="sc">*</span> t<span class="sc">^</span>(shape <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> (rate <span class="sc">*</span> t)<span class="sc">^</span>shape)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># hazard plots for shape = 2, 1, 1 / 2</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">4</span>, <span class="at">by =</span> <span class="fl">0.01</span>)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(t, <span class="fu">hllog</span>(t, <span class="dv">2</span>), <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">lty =</span> <span class="st">"dashed"</span>,</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">ylab =</span> <span class="st">"Log-logistic hazard (rate = 1)"</span>)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(t, <span class="fu">hllog</span>(t))</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(t, <span class="fu">hllog</span>(t, <span class="fl">0.5</span>), <span class="at">lty =</span> <span class="st">"dotted"</span>)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="fu">grid</span>()</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="fl">1.5</span>, <span class="fl">0.5</span>, <span class="st">"shape = 1"</span>)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="dv">3</span>, <span class="fl">0.7</span>, <span class="st">"shape = 2"</span>)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="fl">1.5</span>, <span class="fl">0.1</span>, <span class="st">"shape = 1 / 2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell-output-display">
<div id="fig-hllog" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-hllog-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="survival_files/figure-html/fig-hllog-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5" title="Figure&nbsp;6.5: Hazard functions for the log-logistic distribution with different shape parameters \alpha. All have rate \lambda = 1."><img src="survival_files/figure-html/fig-hllog-1.png" class="img-fluid figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-hllog-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6.5: Hazard functions for the log-logistic distribution with different shape parameters <span class="math inline">\(\alpha\)</span>. All have rate <span class="math inline">\(\lambda = 1\)</span>.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The name of the log-logistic distribution comes from the fact that the logarithm of a log-logistic random variable has a <em>logistic distribution</em> (just like the logarithm of a log-normal random variable has a normal distribution). The log-logistic distribution is used in economics to model the distribution of wealth or income <span class="citation" data-cites="fisk1961graduation">(<a href="references.html#ref-fisk1961graduation" role="doc-biblioref">Fisk 1961</a>)</span>, where it is known as the <em>Fisk distribution</em>.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">R</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>loglogistic.R</strong></pre>
</div>
<div class="sourceCode" id="cb9" data-filename="loglogistic.R"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Fitting a log-logistic distribution</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># To sample a log-logistic random variable in R, you sample a logistic random</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># variable with location = -log(rate) and scale = 1 / shape.</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># The exponential of the logistic variable has a log-logistic distribution</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># with the correct rate and shape parameters.</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Log-logistic distribution and regression (rate = 2, shape = 3)</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>llsample <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">rlogis</span>(<span class="dv">1000</span>, <span class="at">location =</span> <span class="sc">-</span><span class="fu">log</span>(<span class="dv">2</span>), <span class="at">scale =</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">3</span>))</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>llogdat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">time =</span> llsample, <span class="at">event =</span> <span class="dv">1</span>)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>llogreg <span class="ot">&lt;-</span> <span class="fu">survreg</span>(<span class="fu">Surv</span>(time, event) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> llogdat,</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>                   <span class="at">dist =</span> <span class="st">"loglogistic"</span>)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="sc">-</span><span class="fu">coef</span>(llogreg))       <span class="co"># point estimate of rate</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="sc">-</span><span class="fu">confint</span>(llogreg))    <span class="co"># 95% confidence interval for rate</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">/</span> llogreg<span class="sc">$</span>scale         <span class="co"># point estimate of shape</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="co"># log-transformed 95% confidence interval for the shape parameter</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="sc">-</span><span class="fu">log</span>(llogreg<span class="sc">$</span>scale) <span class="sc">+</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    <span class="sc">*</span> <span class="fu">qnorm</span>(.<span class="dv">975</span>) <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="fu">vcov</span>(llogreg)[<span class="st">"Log(scale)"</span>, <span class="st">"Log(scale)"</span>]))</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="co"># plot of true and estimated log-logistic hazard functions</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>llrate_est <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="fu">coef</span>(llogreg))</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>llshape_est <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> llogreg<span class="sc">$</span>scale</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>llrate_true <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>llshape_true <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>h_llog <span class="ot">&lt;-</span> <span class="cf">function</span>(time, rate, shape) {</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># returns last expression if there is no return() statement</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>  (rate <span class="sc">*</span> shape <span class="sc">*</span> (time <span class="sc">*</span> rate)<span class="sc">^</span>(shape <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">/</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>   (<span class="dv">1</span> <span class="sc">+</span> (time<span class="sc">*</span> rate)<span class="sc">^</span>shape))</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">4</span>, <span class="at">by =</span> <span class="fl">0.01</span>)</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(t, <span class="fu">h_llog</span>(t, llrate_true, llshape_true), <span class="at">type =</span> <span class="st">"n"</span>,</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">ylab =</span> <span class="st">"Hazard (Log-logistic)"</span>)</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a><span class="fu">grid</span>()</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(t, <span class="fu">h_llog</span>(t, llrate_est, llshape_est))</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(t, <span class="fu">h_llog</span>(t, llrate_true, llshape_true), <span class="at">lty =</span> <span class="st">"dashed"</span>)</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">lty =</span> <span class="fu">c</span>(<span class="st">"solid"</span>, <span class="st">"dashed"</span>), <span class="at">bg =</span> <span class="st">"white"</span>,</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Estimated hazard function"</span>, <span class="st">"True hazard function"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="cox-snell-residuals" class="level3" data-number="6.4.3">
<h3 data-number="6.4.3" class="anchored" data-anchor-id="cox-snell-residuals"><span class="header-section-number">6.4.3</span> Cox-Snell residuals</h3>
<p>One way to check goodness-of-fit for a parametric failure time model is to use <strong>Cox-Snell residuals</strong> <span class="citation" data-cites="cox1968general">(<a href="references.html#ref-cox1968general" role="doc-biblioref">Cox and Snell 1968</a>)</span>. For an observation <span class="math inline">\((\tentry_i, \texit_i, \delta_i)\)</span>, the Cox-Snell residual is <span class="math display">\[
  \Big(\hat{H}\bigl(\tentry_i\bigr), \hat{H}\bigl(\texit_i\bigr), \delta_i\Big),
\]</span> where the estimated cumulative hazards are playing the role of entry and exit times. When the parametric model is correct, the Cox-Snell residuals are a right-censored and left-truncated sample from an exponential distribution with rate <span class="math inline">\(\lambda = 1\)</span>. To check this, we can plot the Nelson-Aalen estimate of the cumulative hazard for the Cox-Snell residuals and compare it to the exponential(1) cumulative hazard, which is <span class="math inline">\(H(t) = t\)</span>.</p>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-aalen1978nonparametric" class="csl-entry" role="listitem">
Aalen, Odd. 1978. <span>“Nonparametric Inference for a Family of Counting Processes.”</span> <em>The Annals of Statistics</em> 6: 701–26.
</div>
<div id="ref-aalen2008survival" class="csl-entry" role="listitem">
Aalen, Odd, Ørnulf Borgan, and Håkon Gjessing. 2008. <em>Survival and Event History Analysis: A Process Point of View</em>. Springer Science &amp; Business Media.
</div>
<div id="ref-altshuler1970theory" class="csl-entry" role="listitem">
Altshuler, Bernard. 1970. <span>“Theory for the Measurement of Competing Risks in Animal Experiments.”</span> <em>Mathematical Biosciences</em> 6: 1–11.
</div>
<div id="ref-cox1968general" class="csl-entry" role="listitem">
Cox, David R, and E Joyce Snell. 1968. <span>“A General Definition of Residuals.”</span> <em>Journal of the Royal Statistical Society: Series B (Methodological)</em> 30 (2): 248–65.
</div>
<div id="ref-fisk1961graduation" class="csl-entry" role="listitem">
Fisk, Peter R. 1961. <span>“The Graduation of Income Distributions.”</span> <em>Econometrica: Journal of the Econometric Society</em> 29 (2): 171–85.
</div>
<div id="ref-fleming1984nonparametric" class="csl-entry" role="listitem">
Fleming, Thomas R, and David P Harrington. 1984. <span>“Nonparametric Estimation of the Survival Distribution in Censored Data.”</span> <em>Communications in Statistics-Theory and Methods</em> 13 (20): 2469–86.
</div>
<div id="ref-fleming2005counting" class="csl-entry" role="listitem">
———. 2005. <em>Counting Processes and Survival Analysis</em>. Vol. 625. John Wiley &amp; Sons.
</div>
<div id="ref-greenwood1926report" class="csl-entry" role="listitem">
Greenwood, Major. 1926. <span>“The Natural Duration of Cancer.”</span> <em>Reports on Public Health and Medical Subjects</em> 33: 1–26.
</div>
<div id="ref-kaplan1958nonparametric" class="csl-entry" role="listitem">
Kaplan, Edward L, and Paul Meier. 1958. <span>“Nonparametric Estimation from Incomplete Observations.”</span> <em>Journal of the American Statistical Association</em> 53 (282): 457–81.
</div>
<div id="ref-nelson1969hazard" class="csl-entry" role="listitem">
Nelson, Wayne. 1969. <span>“Hazard Plotting for Incomplete Failure Data.”</span> <em>Journal of Quality Technology</em> 1: 27–52.
</div>
<div id="ref-nelson1972theory" class="csl-entry" role="listitem">
———. 1972. <span>“Theory and Applications of Hazard Plotting for Censored Failure Data.”</span> <em>Technometrics</em> 14 (4): 945–66.
</div>
<div id="ref-van2000asymptotic" class="csl-entry" role="listitem">
Van der Vaart, Aad W. 2000. <em>Asymptotic Statistics</em>. Cambridge University Press.
</div>
<div id="ref-weibull1951statistical" class="csl-entry" role="listitem">
Weibull, Waloddi et al. 1951. <span>“A Statistical Distribution Function of Wide Applicability.”</span> <em>Journal of Applied Mechanics</em> 18 (3): 293–97.
</div>
</div>
</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p> The <em>Glivenko-Cantelli theorem</em> guarantees that <span class="math inline">\(\sup_{x \in \mathbb{R}} |\hat{F}_n(x) - F(x)| \rightarrow 0\)</span> as <span class="math inline">\(n \rightarrow \infty\)</span>, so the convergence happens simultaneously for all <span class="math inline">\(x\)</span> <span class="citation" data-cites="van2000asymptotic">(<a href="references.html#ref-van2000asymptotic" role="doc-biblioref">Van der Vaart 2000</a>)</span>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p> Named after American statisticians <a href="https://en.wikipedia.org/wiki/Edward_L._Kaplan">Edward L. Kaplan</a> (1920–2006) and <a href="https://en.wikipedia.org/wiki/Paul_Meier_(statistician)">Paul Meier</a> (1924–2011). Kaplan worked at Bell Telephone Laboratories, the Lawrence Radiation Laboratory (now the Lawrence Berkeley National Laboratory), and Oregon State University. Meier worked at Johns Hopkins and the University of Chicago and was an early advocate for the use of randomization in clinical trials. Both were doctoral students of John Tukey at Princeton. Their 1958 paper is one of the most-cited papers in statistics, with 66,740 citations as of 22 January 2025.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p> <a href="https://en.wikipedia.org/wiki/Major_Greenwood">Major Greenwood</a> (1880–1949) was an English epidemiologist and statistician. He worked at the Lister Institute (now part of the University of London) and joined the newly-created Ministry of Health after serving in the Royal Army Medical Corps in World War I. He studied the health effects of factory work and developed early models of infectious disease transmission. In 1928, he became the first professor of epidemiology at the London School of Hygiene and Tropical Medicine. In an obituary, Austin Bradford Hill wrote that one of Greenwood’s greatest contributions “lay merely in his outlook, in his statistical approach to medicine, then a new approach and one long regarded with suspicion. And he fought this fight continuously and honestly.”<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p> Named after <a href="https://en.wikipedia.org/wiki/Waloddi_Weibull">Waloddi Weibull</a> (1887-1979), a Swedish engineer and applied mathematician who was a member of the Swedish Coast Guard and invented a technique of using explosives to determine the type and thickness of sediments beneath the sea floor.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./longitudinal.html" class="pagination-link" aria-label="Longitudinal Data, Rates, and Counts">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Longitudinal Data, Rates, and Counts</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./studydesign.html" class="pagination-link" aria-label="Cohort and Case-Control Studies">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Cohort and Case-Control Studies</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




<script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>