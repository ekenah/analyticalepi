<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>5&nbsp; Longitudinal Data, Rates, and Counts – Analytical Epidemiology</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./survival.html" rel="next">
<link href="./bayes.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-747bc48f972f7c4036e4d8e8c6d9e55a.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script>
  window.MathJax = {
    tex: {
      macros: {
        A: "\\mathcal\{A\}",
        approxsim: "\\stackrel\{\\text\{approx\}\}\{\\sim\}",
        AR: "\\text\{AR\}",
        B: "\\mathcal\{B\}",
        Bernoulli: ["\\operatorname\{Bernoulli\}"],
        binomial: ["\\operatorname\{binomial\}"],
        C: "\\mathcal\{C\}",
        chisqH: "\\chi^2_\\text\{H\}",
        chisqP: "\\chi^2_\\text\{P\}",
        chisqPobs: "\\chi^2_\\text\{Pobs\}",
        cHR: "\\text\{cHR\}",
        cloglog: ["\\operatorname\{cloglog\}"],
        comp: "\\mathsf\{C\}",
        Cov: ["\\operatorname\{Cov\}"],
        D: "\\mathcal\{D\}",
        data: "\\text\{data\}",
        dif: "\\text\{d\}",
        Dminus: "\\text\{D\}^-",
        Dplus: "\\text\{D\}^+",
        E: ["\\operatorname\{\\mathbb\{E\}\}"],
        ESSR: "\\text\{ESSR\}",
        expit: ["\\operatorname\{expit\}"],
        given: ["\\, #1| \\, ", 1],
        HR: "\\text\{HR\}",
        indep: "\\perp\\!\\!\\!\\perp",
        indicator: "\\mathbb\{1\}",
        IRR: "\\text\{IRR\}",
        K: "\\mathcal\{K\}",
        logit: ["\\operatorname\{logit\}"],
        margins: "\\text\{margins\}",
        obs: "\\text\{obs\}",
        odds: ["\\operatorname\{odds\}"],
        OR: "\\text\{OR\}",
        PAR: "\\text\{PAR\}",
        ptrue: "p_\{\\text\{true\}\}",
        R: "\\mathcal\{R\}",
        RD: "\\text\{RD\}",
        RR: "\\text\{RR\}",
        sens: "\\text\{sens\}",
        spec: "\\text\{spec\}",
        supp: ["\\operatorname\{supp\}"],
        tcens: "t^\\text\{cens\}",
        tentry: "t^\\text\{entry\}",
        tevent: "t^\\text\{event\}",
        texit: "t^\\text\{exit\}",
        Tminus: "\\text\{T\}^-",
        tonset: "t^\\text\{onset\}",
        Tplus: "\\text\{T\}^+",
        transpose: "\\mathsf{T}",
        trec: "t^\\text\{rec\}",
        true: "\\text\{true\}",
        twobytwo: "2 \\times 2",
        vand: "\\text\{ and \}",
        Var: ["\\operatorname\{Var\}"],
        Xminus: "\\text\{X\}^-",
        Xobs: "\\text\{X\}^\\text\{obs\}",
        Xplus: "\\text\{X\}^+"
      }
    }
  };
</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./probability.html">Defining and Measuring Disease Occurrence</a></li><li class="breadcrumb-item"><a href="./longitudinal.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Longitudinal Data, Rates, and Counts</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Analytical Epidemiology</a> 
        <div class="sidebar-tools-main">
    <a href="./Analytical-Epidemiology.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Defining and Measuring Disease Occurrence</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./probability.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Probability, Random Variables, and Disease Occurrence</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./condprob.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Conditional Probability and Diagnostic Tests</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mlestimation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Maximum Likelihood Estimation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bayes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Bayesian Estimation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./longitudinal.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Longitudinal Data, Rates, and Counts</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./survival.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">One-Sample Survival Analysis</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Study Design and Measures of Association</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./studydesign.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Cohort and Case-Control Studies</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./validity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Internal and External Validity</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cohort.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Measures of Association in Cohort Studies</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./survival2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Two-Sample Survival Analysis and the Cox Model</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./casecontrol.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Design and Analysis of Case-Control and Case-Cohort studies</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bayes2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Bayesian analysis of cohort and case-control studies</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Principles of Causal Inference</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./causality.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Causality in Public Health</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./counterfactuals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Potential Outcomes and Attributable Risk</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Epidemologic and Statistical Methods for Causal Inference</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./calculus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Calculus</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="2">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sec-incomplete" id="toc-sec-incomplete" class="nav-link active" data-scroll-target="#sec-incomplete"><span class="header-section-number">5.1</span> Incomplete follow-up</a>
  <ul class="collapse">
  <li><a href="#right-censoring" id="toc-right-censoring" class="nav-link" data-scroll-target="#right-censoring"><span class="header-section-number">5.1.1</span> Right censoring</a></li>
  <li><a href="#delayed-entry-left-truncation" id="toc-delayed-entry-left-truncation" class="nav-link" data-scroll-target="#delayed-entry-left-truncation"><span class="header-section-number">5.1.2</span> Delayed entry (left truncation)</a></li>
  <li><a href="#left-censoring-and-right-truncation" id="toc-left-censoring-and-right-truncation" class="nav-link" data-scroll-target="#left-censoring-and-right-truncation"><span class="header-section-number">5.1.3</span> Left censoring and right truncation</a></li>
  </ul></li>
  <li><a href="#failure-time-distributions" id="toc-failure-time-distributions" class="nav-link" data-scroll-target="#failure-time-distributions"><span class="header-section-number">5.2</span> Failure time distributions</a>
  <ul class="collapse">
  <li><a href="#sec-surv" id="toc-sec-surv" class="nav-link" data-scroll-target="#sec-surv"><span class="header-section-number">5.2.1</span> Survival function</a></li>
  <li><a href="#sec-haz" id="toc-sec-haz" class="nav-link" data-scroll-target="#sec-haz"><span class="header-section-number">5.2.2</span> Hazard function</a></li>
  <li><a href="#sec-cumhaz" id="toc-sec-cumhaz" class="nav-link" data-scroll-target="#sec-cumhaz"><span class="header-section-number">5.2.3</span> Cumulative hazard function</a></li>
  <li><a href="#sec-survlik" id="toc-sec-survlik" class="nav-link" data-scroll-target="#sec-survlik"><span class="header-section-number">5.2.4</span> Likelihoods for right-censored and left-truncated data</a></li>
  </ul></li>
  <li><a href="#exponential-distribution" id="toc-exponential-distribution" class="nav-link" data-scroll-target="#exponential-distribution"><span class="header-section-number">5.3</span> Exponential distribution</a>
  <ul class="collapse">
  <li><a href="#mean-and-variance" id="toc-mean-and-variance" class="nav-link" data-scroll-target="#mean-and-variance"><span class="header-section-number">5.3.1</span> Mean and variance</a></li>
  <li><a href="#sec-incrate" id="toc-sec-incrate" class="nav-link" data-scroll-target="#sec-incrate"><span class="header-section-number">5.3.2</span> Incidence rates</a></li>
  <li><a href="#memoryless-property" id="toc-memoryless-property" class="nav-link" data-scroll-target="#memoryless-property"><span class="header-section-number">5.3.3</span> Memoryless property</a></li>
  <li><a href="#prevalence-incidence-and-duration-of-disease" id="toc-prevalence-incidence-and-duration-of-disease" class="nav-link" data-scroll-target="#prevalence-incidence-and-duration-of-disease"><span class="header-section-number">5.3.4</span> Prevalence, incidence, and duration of disease*</a></li>
  </ul></li>
  <li><a href="#sec-Poisson" id="toc-sec-Poisson" class="nav-link" data-scroll-target="#sec-Poisson"><span class="header-section-number">5.4</span> Poisson distribution</a>
  <ul class="collapse">
  <li><a href="#mean-and-variance-1" id="toc-mean-and-variance-1" class="nav-link" data-scroll-target="#mean-and-variance-1"><span class="header-section-number">5.4.1</span> Mean and variance</a></li>
  <li><a href="#incidence-rates-via-count-data" id="toc-incidence-rates-via-count-data" class="nav-link" data-scroll-target="#incidence-rates-via-count-data"><span class="header-section-number">5.4.2</span> Incidence rates via count data</a></li>
  <li><a href="#small-sample-estimation-of-incidence-rates" id="toc-small-sample-estimation-of-incidence-rates" class="nav-link" data-scroll-target="#small-sample-estimation-of-incidence-rates"><span class="header-section-number">5.4.3</span> Small-sample estimation of incidence rates</a></li>
  <li><a href="#poisson-approximation-to-the-binomial-for-rare-events" id="toc-poisson-approximation-to-the-binomial-for-rare-events" class="nav-link" data-scroll-target="#poisson-approximation-to-the-binomial-for-rare-events"><span class="header-section-number">5.4.4</span> Poisson approximation to the binomial for rare events*</a></li>
  </ul></li>
  <li><a href="#bayesian-estimation-of-incidence-rates" id="toc-bayesian-estimation-of-incidence-rates" class="nav-link" data-scroll-target="#bayesian-estimation-of-incidence-rates"><span class="header-section-number">5.5</span> Bayesian estimation of incidence rates</a>
  <ul class="collapse">
  <li><a href="#gamma-conjugate-distribution" id="toc-gamma-conjugate-distribution" class="nav-link" data-scroll-target="#gamma-conjugate-distribution"><span class="header-section-number">5.5.1</span> Gamma conjugate distribution</a></li>
  <li><a href="#jeffreys-confidence-interval" id="toc-jeffreys-confidence-interval" class="nav-link" data-scroll-target="#jeffreys-confidence-interval"><span class="header-section-number">5.5.2</span> Jeffreys confidence interval</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./probability.html">Defining and Measuring Disease Occurrence</a></li><li class="breadcrumb-item"><a href="./longitudinal.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Longitudinal Data, Rates, and Counts</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Longitudinal Data, Rates, and Counts</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<blockquote class="blockquote">
<p>The <em>mortality</em> and <em>force of mortality</em> will readily be distinguished, by comparing cholera with consumption; the <em>mortality</em> of the latter is 90–100 per cent, but its mean duration is two years, and the <em>force of mortality</em> is consequently nearly 0.50; the mortality in cholera is not 50 per cent, while the force of mortality is 2415, for cholera destroys in a week as many as phthisis consumes in a year. Phthisis is more dangerous than cholera; but cholera, probably, excites the greatest terror. <span class="citation" data-cites="farr1838on">(<a href="references.html#ref-farr1838on" role="doc-biblioref">Farr 1838</a>)</span><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
</blockquote>
<p>The meaning of a risk or cumulative incidence depends on the time interval over which it is observed. William Farr observed that a risk of death slightly less than 50% over one week for cholera patients was widely considered more alarming than a risk of death greater than 90% over two years for tuberculosis patients. In public health, it matters a great deal how quickly things happen. How rapidly an event occurs is measured using a <strong>rate</strong>, which has units of events per unit time <span class="citation" data-cites="elandt1975definition morgenstern1980measures">(<a href="references.html#ref-elandt1975definition" role="doc-biblioref">Elandt-Johnson 1975</a>; <a href="references.html#ref-morgenstern1980measures" role="doc-biblioref">Morgenstern, Kleinbaum, and Kupper 1980</a>)</span>. To estimate a risk or a rate, we use <strong>longitudinal data</strong> where individuals are followed over time. The analysis of longitudinal data is complicated by the fact that individuals can come and go during the study period.</p>
<p>To estimate the risk of disease onset in a time interval <span class="math inline">\((t_a, t_b]\)</span>, we would follow individuals from time <span class="math inline">\(t_a\)</span> to time <span class="math inline">\(t_b\)</span> to ascertain disease onset. From <a href="probability.html#sec-riskdef" class="quarto-xref"><span>Section 1.5.2</span></a>, the risk of disease onset in the time interval <span class="math inline">\((t_a, t_b]\)</span> is <span class="math display">\[
  \Pr\bigl(\{\omega \in \Omega: D(\omega) = 1\}\bigr)
\]</span> where <span class="math display">\[
  D(\omega) =
  \begin{cases}
    1 &amp; \text{if } \omega \text{ has } \tonset \in (t_a, t_b], \\
    0 &amp; \text{otherwise}.
  \end{cases}
\]</span> and <span class="math inline">\(\tonset\)</span> denotes the onset time of the disease. In practice, the population <span class="math inline">\(\Omega\)</span> is often defined to consist only of individuals who are at risk of disease at time <span class="math inline">\(t_a\)</span>. If we have complete follow-up of the entire population <span class="math inline">\(\Omega\)</span> over the entire interval <span class="math inline">\((t_a, t_b]\)</span>, then we know the cumulative incidence exactly.</p>
<p>More often, we follow a sample of individuals from the population. If selection into the sample is independent of disease onset during <span class="math inline">\((t_a, t_b]\)</span> and we have complete follow-up over the entire interval, then we can get point and interval estimates of the true cumulative incidence using methods for a binomial proportion from <a href="mlestimation.html" class="quarto-xref"><span>Chapter 3</span></a> or <a href="bayes.html" class="quarto-xref"><span>Chapter 4</span></a>. In practice, almost all longitudinal studies have individuals entering or leaving the study during the follow-up period. When this occurs, methods for binomial proportions can produce inefficient or biased estimates of risk.</p>
<p>The analysis of incomplete longitudinal data is called <strong>survival analysis</strong>, and it is the theoretical foundation for many epidemiologic methods. To analyze survival data, it is important to have clear definitions of the following that can be applied equally to all study participants:</p>
<ul>
<li><p>The <strong>time origin</strong>: This is the beginning of the time-to-event, and it defines the time scale used in the analysis. It could be a particular calendar time, a particular age, or the occurrence of a particular event (see <a href="#tbl-origin" class="quarto-xref">Table&nbsp;<span>5.1</span></a>).</p></li>
<li><p>The <strong>failure time</strong> or <strong>event time</strong>: This is the end of the time-to-event. Both the outcome and its occurrence time need careful but practical operational definitions that can be applied equally to all participants in the study.</p></li>
<li><p>The <strong>observation process</strong> and <strong>at-risk process</strong>: For their disease onset time to be observed, individual <span class="math inline">\(i\)</span> must be both at risk of the outcome and under observation at <span class="math inline">\(\tonset_i\)</span>. The observation and at-risk processes are required to be <em>predictable</em>, which means that their value at any time <span class="math inline">\(t\)</span> is determined just before time <span class="math inline">\(t\)</span>.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> For example, if observation begins at time <span class="math inline">\(t\)</span>, you are under observation just after time <span class="math inline">\(t\)</span> but not at time <span class="math inline">\(t\)</span> itself. If observation ends at time <span class="math inline">\(t\)</span>, then you are under observation up to and including time <span class="math inline">\(t\)</span>.</p></li>
<li><p>The <strong>entry time</strong> <span class="math inline">\(\tentry_i\)</span> is the earliest time at which the individual <span class="math inline">\(i\)</span> is both at risk of the outcome and under observation. If the entry time occurs after the origin, we have <strong>delayed entry</strong>, which is also called <strong>left truncation</strong>.</p></li>
<li><p>The <strong>exit time</strong> or <strong>follow-up time</strong> <span class="math inline">\(t_i\)</span> is the last time the individual is both at risk of the outcome and under observation. If the exit time occurs before the failure time, we have <strong>right censoring</strong> (loss to follow-up).</p></li>
</ul>
<p>In complex data, an individual can have multiple entry, exit, and failure times and even multiple time origins (e.g., time to heart attack after vigorous exercise or ingestion of cocaine). The time scale is usually defined so that <span class="math inline">\(t = 0\)</span> at the origin time, and we will assume that the origin and population are defined so that all individuals in the population are at risk of the event at <span class="math inline">\(t = 0\)</span>.</p>
<div id="tbl-origin" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-origin-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;5.1: Time scales and time origins adapted from <span class="citation" data-cites="clayton1993statistical">Clayton and Hills (<a href="references.html#ref-clayton1993statistical" role="doc-biblioref">1993</a>)</span>.
</figcaption>
<div aria-describedby="tbl-origin-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Time scale</th>
<th style="text-align: left;">Origin</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Calendar time</td>
<td style="text-align: left;">Fixed date</td>
</tr>
<tr class="even">
<td style="text-align: left;">Time since exposure</td>
<td style="text-align: left;">Exposure time</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Time under treatment</td>
<td style="text-align: left;">Start of treatment</td>
</tr>
<tr class="even">
<td style="text-align: left;">Time since diagnosis</td>
<td style="text-align: left;">Time of diagnosis</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Age</td>
<td style="text-align: left;">e.g., 65th birthday</td>
</tr>
<tr class="even">
<td style="text-align: left;">Time in hospital</td>
<td style="text-align: left;">Hospital admission</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<section id="sec-incomplete" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="sec-incomplete"><span class="header-section-number">5.1</span> Incomplete follow-up</h2>
<p>Let <span class="math inline">\(\tevent\)</span> be the failure time of individual <span class="math inline">\(i\)</span> and <span class="math inline">\(\tcens\)</span> be the last time at which they would be under observation if they had no disease onset. We assume all times are defined so that <span class="math inline">\(t = 0\)</span> at the time origin.</p>
<section id="right-censoring" class="level3" data-number="5.1.1">
<h3 data-number="5.1.1" class="anchored" data-anchor-id="right-censoring"><span class="header-section-number">5.1.1</span> Right censoring</h3>
<p>When <span class="math inline">\(\tcens_i &lt; \tevent_i\)</span>, the outcome in person <span class="math inline">\(i\)</span> is <strong>right censored</strong> at time <span class="math inline">\(\tcens_i\)</span>. We know that individual <span class="math inline">\(i\)</span> does not have an event at or before <span class="math inline">\(\tcens_i\)</span>, but we do not know when or if the event will occur after that. In right-censored data, we see the exit time <span class="math display">\[
    t_i = \min\bigl(\tevent_i, \tcens_i\bigr)
\]</span> and the <strong>event indicator</strong> <span class="math display">\[
    \delta_i
    = \begin{cases}
        0 &amp; \text{if } \texit_i = \tcens_i,\\
        1 &amp; \text{if } \texit_i = \tevent_i.
    \end{cases}
\]</span> Right censoring is often just called <em>censoring</em>. There are many reasons that person <span class="math inline">\(i\)</span> might be censored: Perhaps we can no longer find person <span class="math inline">\(i\)</span> (loss to follow-up), person <span class="math inline">\(i\)</span> is no longer at risk of failure (e.g., a woman who has a hysterectomy is no longer at risk of uterine cancer), or observation ends. Different individuals in the same study can be censored for different reasons.</p>
<p><strong>Independent right censoring</strong> occurs if those who remain under observation at any given time are a random sample of all of those who would be under observation if there were no right censoring. Censoring is not independent if those who remain under observation have systematically different failure times than those who are censored. There are three canonical types of independent censoring:</p>
<ul>
<li><em>Type I censoring</em> occurs when observation of each individual ends at a predetermined time under the control of the investigators.</li>
<li><em>Type II censoring</em> occurs when observation ends after a predetermined number of events have been observed.</li>
<li><em>Random censoring</em> occurs when each person <span class="math inline">\(i\)</span> has a random censoring time <span class="math inline">\(\tcens_i\)</span> that is independent of his or her failure time <span class="math inline">\(\tevent_i\)</span> and not under the control of the investigators.</li>
</ul>
<p>As long as all censoring is independent, different censoring mechanisms can occur within the same study. All of the methods we will discuss assume independent censoring, and they become biased under <em>dependent</em> or <em>informative</em> censoring.</p>
</section>
<section id="delayed-entry-left-truncation" class="level3" data-number="5.1.2">
<h3 data-number="5.1.2" class="anchored" data-anchor-id="delayed-entry-left-truncation"><span class="header-section-number">5.1.2</span> Delayed entry (left truncation)</h3>
<p>Whereas right censoring concerns the observation of failure times, truncation concerns the selection of study participants. <strong>Delayed entry</strong> or <strong>left truncation</strong> occurs when an individual <span class="math inline">\(i\)</span> has an entry time <span class="math inline">\(\tentry_i &gt; 0\)</span> where <span class="math inline">\(t = 0\)</span> denotes the origin. If person <span class="math inline">\(i\)</span> had disease onset before <span class="math inline">\(\tentry_i\)</span>, he or she would have been excluded from the study. Person-time prior to entry cannot be included as time at risk; it is called <strong>immortal person-time</strong>. Delayed entry can be handled easily by all of the methods we will discuss. As with independent right censoring, we require that the set of individuals under observation are a random sample of the individuals who would be under observation if we had no right censoring or left truncation. You can think of this as <strong>independent left truncation</strong></p>
</section>
<section id="left-censoring-and-right-truncation" class="level3" data-number="5.1.3">
<h3 data-number="5.1.3" class="anchored" data-anchor-id="left-censoring-and-right-truncation"><span class="header-section-number">5.1.3</span> Left censoring and right truncation</h3>
<p>Given that we have right censoring and left truncation (delayed entry), it is natural to wonder whether there is also left censoring and right truncation. Unfortunately, the answer is yes:</p>
<ul>
<li><em>Left censoring</em> means that we know an individual had an event before a left-censoring time but we do not know when.</li>
<li><em>Right truncation</em> means that our sample contains only individuals who have already had the event.</li>
</ul>
<p>Both of these must be handled using strong assumptions or specialized methods. Some areas of epidemiology must contend with left censoring (e.g., we know that a birth defect occurred prior to birth but not exactly when) or right truncation. Usually, they can be prevented or minimized by good study design.</p>
</section>
</section>
<section id="failure-time-distributions" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="failure-time-distributions"><span class="header-section-number">5.2</span> Failure time distributions</h2>
<p>Failure time distributions are descibed in terms of survival functions, cumulative hazard functions, and hazard functions. Any one of these is sufficient to specify the distribution of the time to an event, but each has a different and useful interpretation. We denote the failure time as a positive random variable <span class="math inline">\(T\)</span>. For simplicity, we will assume that <span class="math inline">\(T\)</span> is continuous.</p>
<section id="sec-surv" class="level3" data-number="5.2.1">
<h3 data-number="5.2.1" class="anchored" data-anchor-id="sec-surv"><span class="header-section-number">5.2.1</span> Survival function</h3>
<p>The <strong>survival function</strong> for a failure time <span class="math inline">\(T\)</span> is <span class="math display">\[
  S(t) = \Pr(T &gt; t),
\]</span> which is the probability that the event does not occur up to and including time <span class="math inline">\(t\)</span>. Several properties follow from this definition:</p>
<ul>
<li><p>Because it is a probability, <span class="math inline">\(S(t) \in [0, 1]\)</span> for all <span class="math inline">\(t\)</span>.</p></li>
<li><p>Because <span class="math inline">\(T &gt; 0\)</span>, <span class="math inline">\(S(0) = 1\)</span>.</p></li>
<li><p><span class="math inline">\(S(t)\)</span> is monotonically decreasing, which means that it cannot increase. If <span class="math inline">\(u &gt; t\)</span>, you can survive to time <span class="math inline">\(u\)</span> only if you survive to time <span class="math inline">\(t\)</span>, so <span class="math inline">\(S(t) \geq S(u)\)</span>.</p></li>
</ul>
<p>The survival function <span class="math inline">\(S(t)\)</span> tells us everything there is to know about the distribution of the time-to-event <span class="math inline">\(T\)</span>. The <strong>cumulative incidence function</strong> is <span class="math display">\[
  F(t) = 1 - S(t) = \Pr(T \leq t),
\]</span> which is also the cumulative distribution function (CDF) for <span class="math inline">\(T\)</span>. If <span class="math inline">\(T\)</span> is a continuous random variable, then <span id="eq-Sf"><span class="math display">\[
  -S'(t) = F'(t) = f(t),
\tag{5.1}\]</span></span> where <span class="math inline">\(f(t)\)</span> is the probability density function (PDF) of <span class="math inline">\(T\)</span>. If <span class="math inline">\(T\)</span> is a discrete or continuous failure time with survival function <span class="math inline">\(S(t)\)</span>, it turns out that <span id="eq-Smean"><span class="math display">\[
  \E[T] = \int_0^\infty S(t) \,\dif t.
\tag{5.2}\]</span></span> This is often easier to calculate than the integral <span class="math inline">\(\E[T] = \int_0^t t f(t) \dif t\)</span> that is normally used to define the mean of a positive random variable.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> The <span class="math inline">\(p\)</span>th quantile of the failure time distribution is the solution to the equation <span id="eq-Squantile"><span class="math display">\[
  p = F(t_p) = 1 - S(t_p),
\tag{5.3}\]</span></span> so higher quantiles correspond to longer times to events.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a> When <span class="math inline">\(p = 0.5\)</span>, we get the median time-to-event. Much of survival analysis is dedicated to calculating and comparing survival functions.</p>
</section>
<section id="sec-haz" class="level3" data-number="5.2.2">
<h3 data-number="5.2.2" class="anchored" data-anchor-id="sec-haz"><span class="header-section-number">5.2.2</span> Hazard function</h3>
<p>For any <span class="math inline">\(\Delta &gt; 0\)</span>, the probability that you have an event in the time interval <span class="math inline">\((t, t + \Delta]\)</span> is <span class="math display">\[
  \Pr\bigl(\text{event in } (t, t + \Delta]\bigr)
  = S(t) - S(t + \Delta)
\]</span> and the conditional probability that you have an event in the interval given that you survived until time <span class="math inline">\(t\)</span> is <span id="eq-cpfail"><span class="math display">\[
  \Pr\bigl(\text{event in } (t, t + \Delta] \,\big|\, \text{survival until } t\bigr)
   = \frac{S(t) - S(t + \Delta)}{S(t)}.
\tag{5.4}\]</span></span> The numerator is the expected number of events in <span class="math inline">\((t, t + \Delta]\)</span> given that you remain at risk at time <span class="math inline">\(t\)</span>. Dividing by <span class="math inline">\(\Delta\)</span> gives us <span class="math display">\[
  \frac{S(t) - S(t + \Delta)}{S(t) \Delta},
\]</span> which is the expected number of events per unit time in the interval <span class="math inline">\((t, t + \Delta]\)</span>. The <strong>hazard function</strong> is the limit of this expected number of events per unit time as <span class="math inline">\(\Delta \downarrow 0\)</span> (i.e., as <span class="math inline">\(\Delta\)</span> decreases to zero): <span id="eq-hlim"><span class="math display">\[
  h(t) = \lim_{\Delta \downarrow 0} \frac{S(t) - S(t + \Delta)}{S(t) \Delta}.
\tag{5.5}\]</span></span> Because the numerator is nonnegative and the denominator is positive, <span class="math inline">\(h(t) \geq 0\)</span>. The hazard function <span class="math inline">\(h(t)\)</span> measures the instantaneous expected number of events per unit time like a speedometer measures the instantaneous speed of a vehicle. When <span class="math inline">\(h(t)\)</span> is high, you are likely to have an event soon after time <span class="math inline">\(t\)</span> if you have survived event-free until <span class="math inline">\(t\)</span>. When <span class="math inline">\(h(t)\)</span> is low, you are relatively unlikely to have an event soon after <span class="math inline">\(t\)</span>.</p>
<p>Unlike the survival function, the hazard function has units. Because we divide an expected number of events by a time interval <span class="math inline">\(\Delta\)</span>, the hazard has units of <span class="math inline">\(\text{events} / \text{time}\)</span>. Just like the same speed can be expressed in miles per hour or kilometers per hour, using different measures of time (e.g., month, week, day, hour, minute, or second) changes the numerical value of the hazard but not its meaning.</p>
<p>When <span class="math inline">\(\Delta\)</span> is small, then <a href="#eq-cpfail" class="quarto-xref">Equation&nbsp;<span>5.4</span></a> and <a href="#eq-hlim" class="quarto-xref">Equation&nbsp;<span>5.5</span></a> give us <span class="math display">\[
  h(t) \approx
  \frac{\Pr\bigl(\text{event in } (t, t + \Delta] \,\big|\, \text{survival until } t\bigr)}{\Delta}.
\]</span> Rearranging, we get <span class="math display">\[
  h(t) \Delta \approx \Pr\bigl(\text{event in } (t, t + \Delta] \,\big|\, \text{survival until } t\bigr).
\]</span> Notice how the units work: <span id="eq-hunits"><span class="math display">\[
  h(t) \frac{\text{events}}{\text{time unit}} \Delta \text{ time units} = h(t) \Delta \text{ events}.
\tag{5.6}\]</span></span> Multiplying the hazard by a time interval gives the expected number of events that would occur in that interval if the hazard remained constant.</p>
<p>When times to failure are continuous, the survival function is differentiable. By definition of the derivative of <span class="math inline">\(S(t)\)</span>, <span class="math display">\[
  \lim_{\Delta \downarrow 0} \frac{S(t) - S(t + \Delta)}{\Delta}
  = -S'(t).
\]</span> Putting this back into <a href="#eq-hlim" class="quarto-xref">Equation&nbsp;<span>5.5</span></a>, we get <span id="eq-hS"><span class="math display">\[
  h(t)
  = \frac{1}{S(t)} \lim_{\Delta \downarrow 0} \frac{S(t) - S(t + \Delta)}{\Delta}
  = \frac{-S'(t)}{S(t)}.
\tag{5.7}\]</span></span> Because <span class="math inline">\(-S'(t) = f(t)\)</span> from <a href="#eq-Sf" class="quarto-xref">Equation&nbsp;<span>5.1</span></a>, we can multiply both sides by <span class="math inline">\(S(t)\)</span> to get <span id="eq-fhS"><span class="math display">\[
  f(t) = h(t) S(t).
\tag{5.8}\]</span></span> Thus, the PDF is the product of the hazard and survival functions. This is used to write likelihoods for right-censored and left-truncated data.</p>
</section>
<section id="sec-cumhaz" class="level3" data-number="5.2.3">
<h3 data-number="5.2.3" class="anchored" data-anchor-id="sec-cumhaz"><span class="header-section-number">5.2.3</span> Cumulative hazard function</h3>
<p>The <strong>cumulative hazard function</strong> for a positive random variable <span class="math inline">\(T\)</span> is <span id="eq-H"><span class="math display">\[
  H(t) = -\ln S(t).
\tag{5.9}\]</span></span> Several properties follow from this definition:</p>
<ul>
<li><p><span class="math inline">\(H(0) = 0\)</span> because <span class="math inline">\(S(0) = 1\)</span>.</p></li>
<li><p><span class="math inline">\(H(t)\)</span> is monotonically increasing, which means that it cannot decrease. If <span class="math inline">\(u &gt; t\)</span>, then <span class="math inline">\(H(u) \geq H(t)\)</span>.</p></li>
<li><p>When <span class="math inline">\(S(t) &gt; 0\)</span>, <span class="math inline">\(H(t) \in [0, \infty)\)</span>.</p></li>
<li><p><span class="math inline">\(S(t) = e^{-H(t)}\)</span>.</p></li>
</ul>
<p>Taking the derivative with respect to <span class="math inline">\(t\)</span> on both sides of <a href="#eq-H" class="quarto-xref">Equation&nbsp;<span>5.9</span></a> (using the chain rule on the right-hand side), we get <span class="math display">\[
  H'(t) = \frac{-S'(t)}{S(t)} = h(t)
\]</span> where the final equality follows from <a href="#eq-hS" class="quarto-xref">Equation&nbsp;<span>5.7</span></a>. By the fundamental theorem of calculus and the fact that <span class="math inline">\(H(0) = 0\)</span>, <span id="eq-Hintegral"><span class="math display">\[
  H(t) = \int_0^t h(u) \dif u
\tag{5.10}\]</span></span> so the cumulative hazard <span class="math inline">\(H(t)\)</span> is the area under the graph of <span class="math inline">\(h\)</span> over <span class="math inline">\((0, t)\)</span>.</p>
<p><a href="#eq-Hintegral" class="quarto-xref">Equation&nbsp;<span>5.10</span></a> gives us an interesting way to interpret the cumulative hazard function. If the event is something that can be repeated (e.g., clicks on a Geiger counter), the expected number of events in <span class="math inline">\((0, t]\)</span> is the sum of the expected numbers of events in a series of intervals <span class="math inline">\((u_0, u_1], (u_1, u_2], \ldots, (u_{n - 1}, u_n]\)</span> where <span class="math inline">\(u_0 = 0\)</span> and <span class="math inline">\(u_n = t\)</span>. Taking a limit as the number of subintervals grows larger and each subinterval becomes smaller, <span class="math display">\[
  \E\bigl[\text{number of events in} (0, t]\bigr] = \int_0^t h(u) \,\dif u = H(t).
\]</span> The units in the integral work in the same way as in <a href="#eq-hunits" class="quarto-xref">Equation&nbsp;<span>5.6</span></a>. For an event that cannot be repeated (e.g., death), <span class="math inline">\(H(t)\)</span> can be interpreted as the expected number of events that would occur if the event were made repeatable. After an event at time <span class="math inline">\(t\)</span>, you would be brought back to being at risk at time <span class="math inline">\(t\)</span> to wait for the next event to occur.</p>
</section>
<section id="sec-survlik" class="level3" data-number="5.2.4">
<h3 data-number="5.2.4" class="anchored" data-anchor-id="sec-survlik"><span class="header-section-number">5.2.4</span> Likelihoods for right-censored and left-truncated data</h3>
<p>Suppose our survival time distribution has hazard function <span class="math inline">\(h(t, \theta_\true)\)</span> and survival function <span class="math inline">\(S(t, \theta_\true)\)</span>, where <span class="math inline">\(\theta_\true\)</span> is an unknown parameter (or parameter vector). If individual <span class="math inline">\(i\)</span> has entry time <span class="math inline">\(\tentry_i\)</span>, exit time <span class="math inline">\(t_i\)</span>, and event indicator <span class="math inline">\(\delta_i\)</span>, then their likelihood contribution is <span id="eq-Li"><span class="math display">\[
  L_i(\theta) = \frac{h(t_i, \theta)^{\delta_i} S(t_i, \theta)}{S\bigl(\tentry_i, \theta\bigr)}.
\tag{5.11}\]</span></span> In the numerator, every observation contributes a survival term, but only the observed failure times (<span class="math inline">\(\delta_i = 1\)</span>) contribute a hazard term. The survival term in the denominator accounts for the fact that they survived until time <span class="math inline">\(\tentry_i\)</span>. When <span class="math inline">\(\tentry_i = 0\)</span>, then the denominator equals one. <a href="#tbl-longlik" class="quarto-xref">Table&nbsp;<span>5.2</span></a> shows the likelihood contributions for all four possible combinations of right censoring and delayed entry (left truncation).</p>
<div id="tbl-longlik" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-longlik-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;5.2: Possible likelihood contributions for <span class="math inline">\((\tentry_i, t_i, \delta_i)\)</span>.
</figcaption>
<div aria-describedby="tbl-longlik-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: center;">Right censoring (<span class="math inline">\(\delta_i = 0\)</span>)</th>
<th style="text-align: center;">No right censoring (<span class="math inline">\(\delta_i = 1\)</span>)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Delayed entry (<span class="math inline">\(\tentry &gt; 0\)</span>)</strong></td>
<td style="text-align: center;"><span class="math inline">\(\frac{S(t_i, \theta)}{S(\tentry_i, \theta)}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\frac{h(t_i, \theta) S(t_i, \theta)}{S(\tentry_i, \theta)}\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>No delayed entry (<span class="math inline">\(\tentry = 0\)</span>)</strong></td>
<td style="text-align: center;"><span class="math inline">\(S(t_i, \theta)\)</span></td>
<td style="text-align: center;"><span class="math inline">\(h(t_i, \theta) S(t_i, \theta)\)</span></td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>Taking logarithms on both sides of <a href="#eq-Li" class="quarto-xref">Equation&nbsp;<span>5.11</span></a> gives us the log likelihood contribution <span class="math display">\[
  \ell_i(\theta) =
  \delta_i \ln h(t_i, \theta) - [H(t_i, \theta) - H(\tentry_i, \theta)].
\]</span> All observations contribute a cumulative hazard term, but only observed event times contribute a hazard term. When <span class="math inline">\(\tentry_i = 0\)</span>, then <span class="math inline">\(H(0, \theta) = 0\)</span> for all <span class="math inline">\(\theta\)</span>. When we have <span class="math inline">\(n\)</span> independent observations, the log likelihood is the sum of the individual log likelihood contributions: <span class="math display">\[
  \ell(\theta) = \sum_{i = 1}^n \ell_i(\theta).
\]</span> The maximum likelihood estimate <span class="math inline">\(\hat{\theta}\)</span> can be found using the score function <span class="math inline">\(U(\theta) = \ell'(\theta)\)</span>, and its approximate variance is <span class="math inline">\(I(\hat{\theta})^{-1} = [-\ell''(\hat{\theta})]^{-1}\)</span>. The log likelihood can be used to do Wald, score, and likelihood ratio hypothesis tests and obtain the corresponding confidence intervals. For example, the Wald 95% confidence interval in large samples is <span class="math display">\[
  \hat{\theta} \pm 1.96 \sqrt{I(\hat{\theta})^{-1}}.
\]</span> If necessary, the delta method can be used to get confidence intervals that keep <span class="math inline">\(\hat{\theta}\)</span> within an appropriate range of values. Bayesian estimation can be done using the corresponding likelihood <span class="math inline">\(L(\theta) = \exp\bigl(\ell(\theta)\bigr)\)</span></p>
</section>
</section>
<section id="exponential-distribution" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="exponential-distribution"><span class="header-section-number">5.3</span> Exponential distribution</h2>
<p>The exponential distribution is the simplest and most important failure time distribution. It has a constant hazard function <span class="math display">\[
  h(t) = \lambda
\]</span> where <span class="math inline">\(\lambda\)</span> is called the <strong>rate parameter</strong> and has units of <span class="math inline">\(\text{events} / \text{time}\)</span>. Its cumulative hazard function is <span class="math display">\[
  H(t)
  = \int_0^t h(u) \,\dif u
  = \int_0^t \lambda \dif u
  = \lambda t,
\]</span> its the survival function is <span class="math display">\[
    S(t) = e^{-H(t)} = e^{-\lambda t}.
\]</span> A higher rate parameter <span class="math inline">\(\lambda\)</span> implies shorter survival times. The <strong>scale parameter</strong> is <span class="math inline">\(\sigma = \lambda^{-1}\)</span>. A smaller scale parameter corresponds to shorter survival times.</p>
<section id="mean-and-variance" class="level3" data-number="5.3.1">
<h3 data-number="5.3.1" class="anchored" data-anchor-id="mean-and-variance"><span class="header-section-number">5.3.1</span> Mean and variance</h3>
<p>The mean of an exponential random variable <span class="math inline">\(T\)</span> is found most easily by integrating the survival function: <span id="eq-ETexpon"><span class="math display">\[
  \E(T)
  = \int_0^\infty e^{-\lambda t} \,\dif t
  = \frac{1}{\lambda} \int_0^\infty \lambda e^{-\lambda t} \,\dif t
  = \frac{1}{\lambda},
\tag{5.12}\]</span></span> In that integral, we ``creatively multiplied by one’’ to turn the integrand into a exponential PDF and then used the fact that the total area under the PDF is one. Integration by parts can be used to show that <span class="math display">\[
  \E(T^2)
  = \int_0^\infty t^2 \lambda e^{-\lambda t} \,\dif t
  = \frac{2}{\lambda^2},
\]</span> so <span class="math display">\[
    \Var(T)
    = \E(T^2) - \E(T)^2
    = \frac{2}{\lambda^2} - \frac{1}{\lambda^2}
    = \frac{1}{\lambda^2}.
\]</span> by <a href="probability.html#eq-var2" class="quarto-xref">Equation&nbsp;<span>1.10</span></a>. Thus, the standard deviation <span class="math inline">\(\sqrt{\Var(T)} = 1 / \lambda\)</span> is equal to the mean.</p>
</section>
<section id="sec-incrate" class="level3" data-number="5.3.2">
<h3 data-number="5.3.2" class="anchored" data-anchor-id="sec-incrate"><span class="header-section-number">5.3.2</span> Incidence rates</h3>
<p>Now imagine that we want to estimate an unknown rate parameter <span class="math inline">\(\lambda_\true\)</span> for an exponential distribution. Let <span class="math inline">\((\tentry_1, t_1, \delta_1), \ldots (\tentry_n, t_n, \delta_n)\)</span> denote a set of entry times, exit times, and event indicators in a sample of size <span class="math inline">\(n\)</span>. The likelihood is <span class="math display">\[
  L(\lambda) = \prod_{i = 1}^n \lambda^{\delta_i} e^{-\lambda (t_i - \tentry_i)},
\]</span> and the log likelihood is <span id="eq-lexp"><span class="math display">\[
  \ell(\lambda) =
  \sum_{i = 1}^n \big(\delta_i \ln \lambda - \lambda (t_i - \tentry_i)\big)
  = m \ln \lambda - \lambda T,
\tag{5.13}\]</span></span> where <span class="math display">\[
  m = \sum_{i = 1}^n \delta_i
\]</span> is the total number of observed events and <span class="math display">\[
  T = \sum_{i = 1}^n \big(t_i - \tentry_i\big)
\]</span> is the total <strong>person-time</strong>. This is the total time under observation added up over all participants in the study. The likelihood assumes that the same rate <span class="math inline">\(\lambda_\true\)</span> of events per unit time occurs in all of this person-time.</p>
<p>Maximum likelihood estimation of the rate <span class="math inline">\(\lambda_\true\)</span> proceeds in the same way as it did for a probability. The only difference is that we are working with an exponential likelihood for times to events rather than a binomial likelihood for a binary outcome. Differentiating with <span class="math inline">\(\ell(\lambda)\)</span> with respect to <span class="math inline">\(\lambda\)</span>, we get the score function <span id="eq-Uexp"><span class="math display">\[
  U(\lambda) = \frac{m}{\lambda} - T.
\tag{5.14}\]</span></span> Solving the score equation <span class="math inline">\(U(\hat{\lambda}) = 0\)</span> gives us the point estimate <span id="eq-incrate"><span class="math display">\[
  \hat{\lambda} = \frac{m}{T}.
\tag{5.15}\]</span></span> This is called the <strong>incidence rate</strong> in epidemiology. The incidence rate is the maximum likelihood estimate of an exponential rate parameter.</p>
<p>Differentiating <span class="math inline">\(U(\lambda)\)</span> with respect to <span class="math inline">\(\lambda\)</span>, we get the observed information function <span class="math inline">\(I(\lambda) = m / \lambda^2\)</span>. The estimated variance is <span id="eq-Iexp"><span class="math display">\[
  I\big(\hat{\lambda}\big)^{-1}
  = \Bigg(\frac{m}{\big(\frac{m}{T}\big)^2}\Bigg)^{-1}
  = \frac{m}{T^2},
\tag{5.16}\]</span></span> so the Wald 95% confidence interval for <span class="math inline">\(\lambda_\true\)</span> is <span id="eq-lambdaCI"><span class="math display">\[
    \hat{\lambda} \pm 1.96 \sqrt{\frac{m}{T^2}}.
\tag{5.17}\]</span></span> It has relatively poor performance in terms of width and coverage probability. The performance of the Wald confidence interval can be improved using a log transformation, which ensures that the lower bound is greater than zero. Using the delta method, the variance of <span class="math inline">\(\ln \hat{\lambda}\)</span> is approximately <span class="math display">\[
  \bigg(\frac{1}{\hat{\lambda}}\bigg)^2 \frac{m}{T^2}
  = \frac{1}{m},
\]</span> which depends only on the number of events observed. An approximate 95% confidence interval for <span class="math inline">\(\ln(\lambda_0)\)</span> is <span class="math display">\[
  \ln\Big(\frac{m}{T}\Big) \pm 1.96 \sqrt{\frac{1}{m}}.
\]</span> Exponentiating, we get the log-transformed Wald 95% confidence interval <span class="math display">\[
  \frac{m}{T} e^{\pm 1.96 \sqrt{\frac{1}{m}}}.
\]</span> Better interval estimates can be obtained by inverting the score or likelihood ratio test or from Bayesian credible intervals. Among the frequentist large-sample confidence intervals, the likelihood ratio interval has the best performance <span class="citation" data-cites="brown2003interval">(<a href="references.html#ref-brown2003interval" role="doc-biblioref">Brown, Cai, and DasGupta 2003</a>)</span>.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" aria-current="page">R</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>exponential.R</strong></pre>
</div>
<div class="sourceCode" id="cb1" data-filename="exponential.R"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Exponential rate parameter estimation</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># generate right-censored exponential distribution</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>tevent <span class="ot">&lt;-</span> <span class="fu">rexp</span>(<span class="dv">1000</span>, <span class="at">rate =</span> <span class="dv">2</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>tcens <span class="ot">&lt;-</span> <span class="fu">rexp</span>(<span class="dv">1000</span>)             <span class="co"># default rate = 1</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>sdat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">texit =</span> <span class="fu">pmin</span>(tcens, tevent),</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">event =</span> <span class="fu">ifelse</span>(tcens <span class="sc">&lt;</span> tevent, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># calculating incidence rate and log-transformed confidence interval</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">sum</span>(sdat<span class="sc">$</span>event)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>T <span class="ot">&lt;-</span> <span class="fu">sum</span>(sdat<span class="sc">$</span>texit)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>m <span class="sc">/</span> T</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>m <span class="sc">/</span> T <span class="sc">*</span> <span class="fu">exp</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>) <span class="sc">*</span> <span class="fu">qnorm</span>(.<span class="dv">975</span>) <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">/</span> m))</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co"># fitting intercept-only exponential regression model</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co"># This uses the survreg() function from the survival package.</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>expfit <span class="ot">&lt;-</span> <span class="fu">survreg</span>(<span class="fu">Surv</span>(texit, event) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> sdat,</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>                  <span class="at">dist =</span> <span class="st">"exponential"</span>)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(expfit)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(expfit)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(expfit)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="co"># log-transformed Wald CI for the exponential rate</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="co"># The intercept is ln(scale), which is -ln(rate).</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="co"># The rate is exp(-intercept).</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="sc">-</span><span class="fu">coef</span>(expfit))</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="sc">-</span><span class="fu">confint</span>(expfit))</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="co"># add delayed entry (left truncation) to sdat</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>sdat2 <span class="ot">&lt;-</span> sdat</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>sdat2<span class="sc">$</span>tentry <span class="ot">&lt;-</span> <span class="fu">rexp</span>(<span class="dv">1000</span>, <span class="at">rate =</span> <span class="dv">5</span>)</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>sdat2 <span class="ot">&lt;-</span> <span class="fu">subset</span>(sdat2, tentry <span class="sc">&lt;</span> texit)</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="co"># incidence rate and log-transformed confidence interval</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">sum</span>(sdat2<span class="sc">$</span>event)</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>T2 <span class="ot">&lt;-</span> <span class="fu">sum</span>(sdat2<span class="sc">$</span>texit <span class="sc">-</span> sdat2<span class="sc">$</span>tentry)</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>m2 <span class="sc">/</span> T2</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>m2 <span class="sc">/</span> T2 <span class="sc">*</span> <span class="fu">exp</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>) <span class="sc">*</span> <span class="fu">qnorm</span>(.<span class="dv">975</span>) <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">/</span> m2))</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a><span class="co"># survreg() does not handle delayed entry, so use flexsurv::flexsurvreg()</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(flexsurv)</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>expfit2 <span class="ot">&lt;-</span> <span class="fu">flexsurvreg</span>(<span class="fu">Surv</span>(tentry, texit, event) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> sdat2,</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>                       <span class="at">dist =</span> <span class="st">"exp"</span>)</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="co"># The summary() function does not work with flexsurvreg objects.</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Type "expfit2" or "expfit2$res" to get point and interval estimates.</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a><span class="co"># The "se" in expfit2$res is the delta method standard error.</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>expfit2</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>expfit2<span class="sc">$</span>res       <span class="co"># rate parameter scale</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>expfit2<span class="sc">$</span>res.t     <span class="co"># log rate parameter scale</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="memoryless-property" class="level3" data-number="5.3.3">
<h3 data-number="5.3.3" class="anchored" data-anchor-id="memoryless-property"><span class="header-section-number">5.3.3</span> Memoryless property</h3>
<p>Given that you have reached age <span class="math inline">\(a\)</span>, your <strong>life expectancy at age <span class="math inline">\(a\)</span></strong> is how many years you are expected to live past age <span class="math inline">\(a\)</span>. According to the <a href="https://www.ssa.gov/oact/STATS/table4c6_2019_TR2022.html">Social Security Administration’s 2019 life table</a>, life expectancy at birth in the United States in 2019 was 76.22 years for males and 81.28 years for females. Life expectancy at age 40 was 38.74 years for males and 42.76 years for females, which means that the average age at death for those who survive to age 40 was 78.74 years and 82.76 years, respectively. Life expectancy at age 80 was 8.43 years for males and 9.83 years for females, so the average ages at death were 88.43 and 89.83 years, respectively. For humans, remaining life expectancy decreases with age.</p>
<p>Humans do not have exponential lifetimes. If your lifetime has an exponential distribution with rate <span class="math inline">\(\lambda\)</span> and you survive to age <span class="math inline">\(t\)</span>, the probability that you survive to age <span class="math inline">\(t + u\)</span> is <span class="math display">\[
  \Pr(\text{lifetime} &gt; t + u \given{} \text{lifetime} &gt; t)
  = \frac{e^{-\lambda (t + u)}}{e^{-\lambda t}}
  = e^{-u}.
\]</span> This does not depend on <span class="math inline">\(t\)</span>, so your life expectancy would be constant with age. This is called the <strong>memoryless property</strong>.</p>
<p>In a population with exponential lifetimes, the old and the young would have equal hazards of death at any given time and equal risks of death over any time interval. This seems to be true of decaying radioactive isotopes and other processes from physics and chemistry, but humans are more complex. The hazard of death is typically high right after birth, drops rapidly to a minimum between the ages of roughly 5 and 30, and then slowly increases. This is called the <em>bathtub-shaped hazard</em> or the <em>Gompertz-Makeham law of mortality</em> <span class="citation" data-cites="gompertz1825mortality makeham1860law">(<a href="references.html#ref-gompertz1825mortality" role="doc-biblioref">Gompertz 1825</a>; <a href="references.html#ref-makeham1860law" role="doc-biblioref">Makeham 1860</a>)</span>. <a href="#fig-bathtub" class="quarto-xref">Figure&nbsp;<span>5.1</span></a> shows The bathtub-shaped hazard of death for the United States population in 2019.</p>
<div class="cell">
<div class="code-with-filename">
<details class="code-fold">
<summary>Code</summary>
<div class="code-with-filename-file">
<pre><strong>bathtub.R</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># life table for male and female mortality in the United State, 2019</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>lifetab <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="at">file =</span> <span class="st">"R/lifetable-2019.csv"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>hdat <span class="ot">&lt;-</span> <span class="fu">subset</span>(lifetab, age <span class="sc">&lt;=</span> <span class="dv">80</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>hdat<span class="sc">$</span>surv_male <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> hdat<span class="sc">$</span>mortality_male</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>hdat<span class="sc">$</span>surv_female <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> hdat<span class="sc">$</span>mortality_female</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># plot hazard (events per year) for ages 0-80</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hdat<span class="sc">$</span>age, <span class="sc">-</span><span class="fu">log</span>(hdat<span class="sc">$</span>surv_male), <span class="at">type =</span> <span class="st">"l"</span>,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Age (years)"</span>, <span class="at">ylab =</span> <span class="st">"Mortality hazard (deaths per year)"</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(hdat<span class="sc">$</span>age, <span class="sc">-</span><span class="fu">log</span>(hdat<span class="sc">$</span>surv_female), <span class="at">lty =</span> <span class="st">"dashed"</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="fu">grid</span>()</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="at">bg =</span> <span class="st">"white"</span>, <span class="at">lty =</span> <span class="fu">c</span>(<span class="st">"solid"</span>, <span class="st">"dashed"</span>),</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Male"</span>, <span class="st">"Female"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell-output-display">
<div id="fig-bathtub" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-bathtub-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="longitudinal_files/figure-html/fig-bathtub-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="Figure&nbsp;5.1: Mortality hazard (deaths per year) by age in the United States based on the Social Security Administration 2019 life table."><img src="longitudinal_files/figure-html/fig-bathtub-1.png" class="img-fluid figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-bathtub-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.1: Mortality hazard (deaths per year) by age in the United States based on the Social Security Administration 2019 life table.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="prevalence-incidence-and-duration-of-disease" class="level3" data-number="5.3.4">
<h3 data-number="5.3.4" class="anchored" data-anchor-id="prevalence-incidence-and-duration-of-disease"><span class="header-section-number">5.3.4</span> Prevalence, incidence, and duration of disease*</h3>
<p>Suppose the time to disease onset in healthy individuals has an exponential(<span class="math inline">\(\lambda\)</span>) distribution and the time to recovery in diseased individuals has an exponential(<span class="math inline">\(\gamma\)</span>) distribution. Then the incidence rate of disease is <span class="math inline">\(\lambda\)</span> and the mean duration of disease is <span class="math inline">\(1 / \gamma\)</span>. For simplicity, imagine a closed population where individuals move between the healthy and diseased states.</p>
<p>If the prevalence of disease at time <span class="math inline">\(t\)</span> is <span class="math inline">\(p\)</span> and the population has total size <span class="math inline">\(n\)</span>, then the expected number of disease onsets in any time interval <span class="math inline">\((t, t + \dif t]\)</span> is <span class="math inline">\(n (1 - p) \lambda \,\dif t\)</span>. The expected number of recoveries in the same interval is <span class="math inline">\(n p \gamma \dif t\)</span>. For the prevalence to remain roughly constant over time (i.e., to randomly fluctuate around an equilibrium), we need the expected number of onsets and recoveries in each time interval to be the same: Thus, we need <span class="math display">\[
  n (1 - p) \lambda = n p \gamma
\]</span> The left-hand side is the expected number of disease onsets per time unit, and the right-hand side is the expected number of recoveries per time unit. It is critical to use the same time units (e.g., day, week, month, year) for the incidence rate and the duration of disease. This equation can be rearranged to get <span class="math display">\[
  \frac{\lambda}{\gamma} = \frac{p}{1 - p},
\]</span> so <span class="math display">\[
  \text{incidence rate} \times \text{mean duration}
  = \text{prevalence odds}
\]</span> When the prevalence <span class="math inline">\(p\)</span> is low, the prevalence and prevalence odds are roughly equal and we get <span class="math display">\[
  \text{incidence rate} \times \text{mean duration}
  \approx \text{prevalence}.
\]</span> Under more realistic conditions, the relationship between prevalence, incidence, and the duration of disease is more complex <span class="citation" data-cites="freeman1980prevalence preston1987relations keiding1991age alho1992prevalence">(<a href="references.html#ref-freeman1980prevalence" role="doc-biblioref">Freeman and Hutchison 1980</a>; <a href="references.html#ref-preston1987relations" role="doc-biblioref">Preston 1987</a>; <a href="references.html#ref-keiding1991age" role="doc-biblioref">Keiding 1991</a>; <a href="references.html#ref-alho1992prevalence" role="doc-biblioref">Alho 1992</a>)</span>.</p>
</section>
</section>
<section id="sec-Poisson" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="sec-Poisson"><span class="header-section-number">5.4</span> Poisson distribution</h2>
<p>The Poisson distribution<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a> is one of the most important distributions in probability and statistics, and it has many applications in epidemiology. <a href="#sec-cumhaz" class="quarto-xref"><span>Section 5.2.3</span></a> showed that the cumulative hazard <span class="math inline">\(H(t)\)</span> is the expected number of events that occur in <span class="math inline">\((0, t]\)</span> when the event is repeatable. The number of events has a Poisson distribution with mean <span class="math inline">\(H(t)\)</span>.</p>
<p>If events occur at a constant rate <span class="math inline">\(\lambda\)</span>, then the times between events have an exponential(<span class="math inline">\(\lambda\)</span>) distribution. The number <span class="math inline">\(X\)</span> of events that occur in a time interval of length <span class="math inline">\(T\)</span> will have a Poisson distribution with mean <span class="math inline">\(\lambda T\)</span>. The probability mass function (PMF) of a Poisson(<span class="math inline">\(\lambda T\)</span>) distribution is <span id="eq-PoissonPMF"><span class="math display">\[
  \Pr(X = x) = \frac{(\lambda T)^k}{k!} e^{-\lambda T}
  \text{ for } x = 0, 1, 2, \ldots.
\tag{5.18}\]</span></span> and <span class="math inline">\(\supp(X) = \{0, 1, 2, \ldots\}\)</span>. This is a PMF because, by definition, <span class="math display">\[
  e^{\lambda T}
  = \sum_{k = 0}^\infty \frac{(\lambda T)^k}{k!}.
\]</span> Multiplying <span class="math inline">\((\lambda T)^k / k!\)</span> by <span class="math inline">\(e^{-\lambda T}\)</span> ensures that the PMF over all possible values of <span class="math inline">\(X\)</span> equals one. The relationship between the exponential and Poisson distributions can be seen easily for <span class="math inline">\(X = 0\)</span>: <span class="math display">\[
  \Pr(X = 0)
  = \frac{(\lambda T)^0}{0!} e^{-\lambda T}
  = e^{-\lambda T},
\]</span> which is the probability that no event occurs in <span class="math inline">\((0, T]\)</span> when the time-to-event has an exponential(<span class="math inline">\(\lambda\)</span>) distribution.</p>
<section id="mean-and-variance-1" class="level3" data-number="5.4.1">
<h3 data-number="5.4.1" class="anchored" data-anchor-id="mean-and-variance-1"><span class="header-section-number">5.4.1</span> Mean and variance</h3>
<p>The mean of the Poisson(<span class="math inline">\(\lambda T\)</span>) distribution is <span class="math display">\[
  \E[X]
  = \sum_{k = 0}^\infty k \frac{(\lambda T)^k}{k!} e^{-\lambda T}
  = \lambda T e^{\lambda T} e^{-\lambda T}
  = \lambda T.
\]</span> A similar calculation yields <span class="math display">\[
  \E[X^2]
  = \sum_{k = 0}^\infty k^2 \frac{(\lambda T)^k}{k!} e^{-\lambda T}
  = \lambda T + (\lambda T)^2.
\]</span> Using <a href="probability.html#eq-var2" class="quarto-xref">Equation&nbsp;<span>1.10</span></a>, we get <span class="math display">\[
  \Var(X) = [\lambda T + (\lambda T)^2] - (\lambda T)^2 = \lambda T.
\]</span> Thus, both the mean and the variance are <span class="math inline">\(\lambda T\)</span>. Because it equals the mean, the parameter <span class="math inline">\(\lambda T\)</span> is often written <span class="math inline">\(\mu\)</span>. Both <span class="math inline">\(\lambda\)</span> and <span class="math inline">\(\mu\)</span> can be estimated using maximum likelihood or Bayesian methods.</p>
</section>
<section id="incidence-rates-via-count-data" class="level3" data-number="5.4.2">
<h3 data-number="5.4.2" class="anchored" data-anchor-id="incidence-rates-via-count-data"><span class="header-section-number">5.4.2</span> Incidence rates via count data</h3>
<p>Suppose we observe <span class="math inline">\(n\)</span> individuals in whom the time to disease onset is exponential(<span class="math inline">\(\lambda_\true\)</span>), observing a total person-time of <span class="math inline">\(T\)</span> during which <span class="math inline">\(m\)</span> disease onsets occur. If we string together all of the observations, the memoryless property of the exponential distribution guarantees that we get an interval with total length <span class="math inline">\(T\)</span> in which <span class="math inline">\(m\)</span> events occurred and the times between events were exponential(<span class="math inline">\(\lambda_\true\)</span>). Therefore, the total number of events that we see has a Poisson distribution with mean <span class="math inline">\(\lambda_\true T\)</span>. Using the Poisson PMF in <a href="#eq-PoissonPMF" class="quarto-xref">Equation&nbsp;<span>5.18</span></a>, we get the likelihood <span class="math display">\[
  L(\lambda) = \frac{(\lambda T)^m}{m!} e^{-\lambda T}.
\]</span> The corresponding log likelihood is <span class="math display">\[
  \ell(\lambda) = \ln L(\lambda) = m (\ln\lambda + \ln T)
  - \ln(m!) - \lambda T.
\]</span> Taking the derivative with respect to <span class="math inline">\(\lambda\)</span>, we get the score function <span class="math display">\[
  U(\lambda) = \frac{m}{\lambda} - T,
\]</span> which is exactly the same as the score function for <span class="math inline">\(\lambda\)</span> that we got using an exponential likelihood in <a href="#eq-Uexp" class="quarto-xref">Equation&nbsp;<span>5.14</span></a>. Taking another derivative with respect to <span class="math inline">\(\lambda\)</span>, we also get the same estimated variance <span class="math display">\[
  I(\hat{\lambda})^{-1} = \frac{m}{T^2}
\]</span> that we got in <a href="#eq-Iexp" class="quarto-xref">Equation&nbsp;<span>5.16</span></a>. Under the Poisson model for the number of events, the Wald and log-transformed Wald confidence intervals for the unknown incidence rate <span class="math inline">\(\lambda_\true\)</span> are exactly the same as those from the exponential model for the times to events. The score and likelihood ratio tests can be inverted to get confidence intervals that perform better in terms of coverage probability and width than the Wald interval <span class="citation" data-cites="brown2003interval">(<a href="references.html#ref-brown2003interval" role="doc-biblioref">Brown, Cai, and DasGupta 2003</a>)</span>.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">R</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Poisson-rate.R</strong></pre>
</div>
<div class="sourceCode" id="cb3" data-filename="Poisson-rate.R"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Poisson regression for incidence rates</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># generate right-censored exponential distribution</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>tevent <span class="ot">&lt;-</span> <span class="fu">rexp</span>(<span class="dv">1000</span>, <span class="at">rate =</span> <span class="dv">2</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>tcens <span class="ot">&lt;-</span> <span class="fu">rexp</span>(<span class="dv">1000</span>)             <span class="co"># default rate = 1</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>sdat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">texit =</span> <span class="fu">pmin</span>(tcens, tevent),</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">event =</span> <span class="fu">ifelse</span>(tcens <span class="sc">&lt;</span> tevent, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Poisson regression model</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Use log(time) offset to get incidence rate from Poisson(time * incidence rate)</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>poisreg <span class="ot">&lt;-</span> <span class="fu">glm</span>(event <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(texit)), <span class="at">data =</span> sdat, <span class="at">family =</span> <span class="fu">poisson</span>())</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(poisreg))</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co"># GLMs use likelihood ratio confidence intervals in R.</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">confint</span>(poisreg))</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co"># exponential regression for comparison (log-transformed Wald CI)</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>expreg <span class="ot">&lt;-</span> <span class="fu">survreg</span>(<span class="fu">Surv</span>(texit, event) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> sdat, <span class="at">dist =</span> <span class="st">"exponential"</span>)</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="sc">-</span><span class="fu">coef</span>(expreg))</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="sc">-</span><span class="fu">confint</span>(expreg))</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="co"># add delayed entry to sdat</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>sdat2 <span class="ot">&lt;-</span> sdat</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>sdat2<span class="sc">$</span>tentry <span class="ot">&lt;-</span> <span class="fu">rexp</span>(<span class="dv">1000</span>, <span class="at">rate =</span> <span class="dv">5</span>)</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>sdat2 <span class="ot">&lt;-</span> <span class="fu">subset</span>(sdat2, tentry <span class="sc">&lt;</span> texit)</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Poisson regression with delayed entry</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>poisreg2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(event <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(texit <span class="sc">-</span> tentry)), <span class="at">data =</span> sdat2,</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>                <span class="at">family =</span> <span class="fu">poisson</span>())</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(poisreg2))</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">confint</span>(poisreg2))</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a><span class="co"># exponential regression with delayed entry for comparison</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(flexsurv)</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>expreg2 <span class="ot">&lt;-</span> <span class="fu">flexsurvreg</span>(<span class="fu">Surv</span>(tentry, texit, event) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> sdat2,</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>                       <span class="at">dist =</span> <span class="st">"exp"</span>)</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>expreg2<span class="sc">$</span>res</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="small-sample-estimation-of-incidence-rates" class="level3" data-number="5.4.3">
<h3 data-number="5.4.3" class="anchored" data-anchor-id="small-sample-estimation-of-incidence-rates"><span class="header-section-number">5.4.3</span> Small-sample estimation of incidence rates</h3>
<p>The Poisson distribution can be used to calculate confidence limits for the incidence rate <span class="math inline">\(\lambda_\true\)</span> that do not rely on the approximate normality in large samples that is guaranteed by the central limit theorem (CLT). Exact confidence limits can be calculated in a manner similar to the Clopper-Pearson confidence limits for a binomial probability in <a href="mlestimation.html#sec-binexact" class="quarto-xref"><span>Section 3.5.2</span></a>. Bayesian estimation, which does not require asymptotic normality, can also be used for small samples.</p>
<p>If we observe <span class="math inline">\(m\)</span> events in a total person-time <span class="math inline">\(T\)</span>, the median unbiased estimate of <span class="math inline">\(\lambda_\true\)</span> is the value of <span class="math inline">\(\lambda\)</span> that makes <span class="math display">\[
  \Pr\nolimits_\lambda(X \leq m) = \Pr\nolimits_\lambda(X \geq m)
\]</span> where we use the subscript <span class="math inline">\(\lambda\)</span> to indicate that the probabilities are calculated assuming <span class="math inline">\(\lambda_\true = \lambda\)</span>. If <span class="math inline">\(\lambda_\text{med}\)</span> is the median unbiased estimate, then <span class="math display">\[
  \sum_{k = 0}^{m - 1} \frac{\big(\lambda_\text{med} T\big)^k}{k!} e^{-\lambda_\text{med} T}
    + \frac{1}{2} \frac{\big(\lambda_\text{med} T\big)^m}{m!} e^{-\lambda_\text{med} T}
  = \frac{1}{2}.
\]</span> It is the value of <span class="math inline">\(\lambda\)</span> that makes the tail probabilities equal. The median of the distribution of <span class="math inline">\(\lambda_\text{med}\)</span> is always <span class="math inline">\(\lambda_\true\)</span> <span class="citation" data-cites="birnbaum1964median">(<a href="references.html#ref-birnbaum1964median" role="doc-biblioref">Birnbaum 1964</a>)</span>.</p>
<p>The lower exact <span class="math inline">\(1 - \alpha\)</span> confidence limit for <span class="math inline">\(\lambda_\true\)</span> gives the upper tail of the Poisson distribution a probability of <span class="math inline">\(\alpha / 2\)</span> <span class="citation" data-cites="garwood1936fiducial">(<a href="references.html#ref-garwood1936fiducial" role="doc-biblioref">Garwood 1936</a>)</span>. It solves the equation <span class="math display">\[
  \sum_{k = m}^\infty \frac{\big(\lambda_\text{lower} T\big)^k}{k!} e^{-\lambda_\text{lower} T}
  = 1 - \Bigg[\sum_{k = 0}^{m - 1} \frac{\big(\lambda_\text{lower} T\big)^k}{k!} e^{-\lambda_\text{lower} T}\Bigg]
  = \frac{\alpha}{2}.
\]</span> The upper exact <span class="math inline">\(1 - \alpha\)</span> confidence limit for <span class="math inline">\(\lambda_\true\)</span> gives the lower tail of the Poisson distribution a probability of <span class="math inline">\(\alpha / 2\)</span>. It solves the equation <span class="math display">\[
  \sum_{k = 0}^m \frac{\big(\lambda_\text{upper} T\big)^k}{k!} e^{-\lambda_\text{upper} T}
  = \frac{\alpha}{2}.
\]</span> As with the Clopper-Pearson confidence limits for a binomial probability, the exact Poisson confidence limits guarantee a coverage probability (i.e., probability that the confidence interval contains <span class="math inline">\(\lambda_\true\)</span>) of at least <span class="math inline">\(1 - \alpha\)</span>. However, these confidence intervals can be wide and have a coverage probability much higher than <span class="math inline">\(1 - \alpha\)</span> <span class="citation" data-cites="cohen1994mid swift2009comparison">(<a href="references.html#ref-cohen1994mid" role="doc-biblioref">Cohen and Yang 1994</a>; <a href="references.html#ref-swift2009comparison" role="doc-biblioref">Swift 2009</a>)</span>.</p>
<p>Mid-p confidence limits can produce confidence intervals that are narrower and have a coverage probability closer to <span class="math inline">\(1 - \alpha\)</span> <span class="citation" data-cites="lancaster1961significance">(<a href="references.html#ref-lancaster1961significance" role="doc-biblioref">Lancaster 1961</a>)</span>. The lower <span class="math inline">\(1 - \alpha\)</span> mid-p exact confidence limit for the incidence rate <span class="math inline">\(\lambda_\true\)</span> solves the equation <span class="math display">\[
  1 - \Bigg[\sum_{k = 0}^{m - 1}
    \frac{\big(\lambda_\text{lower} T\big)^k}{k!} e^{-\lambda_\text{lower} T}
    + \frac{1}{2} \frac{\big(\lambda_\text{lower} T\big)^m}{m!} e^{-\lambda_\text{lower} T}\Bigg]
  = \frac{\alpha}{2}.
\]</span> The upper <span class="math inline">\(1 - \alpha\)</span> mid-p exact confidence limit solves the equation <span class="math display">\[
  \sum_{k = 0}^{m - 1} \frac{\big(\lambda_\text{upper} T\big)^k}{k!} e^{-\lambda_\text{upper} T} \\
    + \frac{1}{2} \frac{\big(\lambda_\text{upper} T\big)^m}{m!} e^{-\lambda_\text{upper} T}
  = \frac{\alpha}{2}.
\]</span> The coverage probability of the mid-p confidence interval is usually very close to <span class="math inline">\(1 - \alpha\)</span> <span class="citation" data-cites="cohen1994mid swift2009comparison">(<a href="references.html#ref-cohen1994mid" role="doc-biblioref">Cohen and Yang 1994</a>; <a href="references.html#ref-swift2009comparison" role="doc-biblioref">Swift 2009</a>)</span>.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">R</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Poisson-small.R</strong></pre>
</div>
<div class="sourceCode" id="cb4" data-filename="Poisson-small.R"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Small-sample Poisson point and interval estimation</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># median unbiased estimate</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>medrate_pois <span class="ot">&lt;-</span> <span class="cf">function</span>(m, T) {</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># m = number of events, T = total person-time</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Poisson lower tail probability</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  lower_tail <span class="ot">&lt;-</span> <span class="cf">function</span>(rate) {</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">=</span> rate <span class="sc">*</span> T</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ppois</span>(m, mu) <span class="sc">-</span> <span class="fu">dpois</span>(m, mu) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># median unbiased estimate</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  med <span class="ot">&lt;-</span> <span class="fu">uniroot</span>(<span class="cf">function</span>(rate) <span class="fu">lower_tail</span>(rate) <span class="sc">-</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">2</span>, <span class="at">interval =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  med<span class="sc">$</span>root</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="fu">medrate_pois</span>(<span class="dv">7</span>, <span class="dv">22</span>)</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="co"># exact confidence limits</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="co"># The point estimate is the incidence rate m / T, not the median unbiased rate.</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DescTools)</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="fu">PoissonCI</span>(<span class="dv">7</span>, <span class="dv">22</span>, <span class="at">method =</span> <span class="st">"exact"</span>)</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="fu">PoissonCI</span>(<span class="dv">7</span>, <span class="dv">22</span>, <span class="at">method =</span> <span class="st">"exact"</span>, <span class="at">conf.level =</span> <span class="fl">0.8</span>)</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="co"># mid-p confidence limits</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>midp_pois <span class="ot">&lt;-</span> <span class="cf">function</span>(m, T, <span class="at">level=</span><span class="fl">0.95</span>) {</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># m = number of events, T = total person-time</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The default confidence level (1 - type I error probability) is 0.95.</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Poisson mid-p lower tail probability</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>  lower_tail <span class="ot">&lt;-</span> <span class="cf">function</span>(rate) {</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">=</span> rate <span class="sc">*</span> T</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ppois</span>(m, mu) <span class="sc">-</span> <span class="fu">dpois</span>(m, mu) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># lower confidence limit</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>  alpha <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> level</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>  lower <span class="ot">&lt;-</span> <span class="fu">uniroot</span>(<span class="cf">function</span>(rate) <span class="fu">lower_tail</span>(rate) <span class="sc">-</span> (<span class="dv">1</span> <span class="sc">-</span> alpha <span class="sc">/</span> <span class="dv">2</span>),</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>                   <span class="at">interval =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="at">extendInt =</span> <span class="st">"yes"</span>)</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># upper confidence limit</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>  upper <span class="ot">&lt;-</span> <span class="fu">uniroot</span>(<span class="cf">function</span>(rate) <span class="fu">lower_tail</span>(rate) <span class="sc">-</span> alpha <span class="sc">/</span> <span class="dv">2</span>,</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>                   <span class="at">interval =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="at">extendInt =</span> <span class="st">"yes"</span>)</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># names for confidence limits</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>  lower_perc <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">round</span>(alpha <span class="sc">/</span> <span class="dv">2</span> <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">3</span>), <span class="st">"%"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>  upper_perc <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">round</span>((<span class="dv">1</span> <span class="sc">-</span> alpha <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">3</span>), <span class="st">"%"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>  <span class="co"># return named vector of confidence limits</span></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>  conflimits <span class="ot">&lt;-</span> <span class="fu">c</span>(lower<span class="sc">$</span>root, upper<span class="sc">$</span>root)</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(conflimits) <span class="ot">&lt;-</span> <span class="fu">c</span>(lower_perc, upper_perc)</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>  conflimits</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a><span class="fu">midp_pois</span>(<span class="dv">7</span>, <span class="dv">22</span>)</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a><span class="fu">midp_pois</span>(<span class="dv">7</span>, <span class="dv">22</span>, <span class="at">level =</span> <span class="fl">0.8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="poisson-approximation-to-the-binomial-for-rare-events" class="level3" data-number="5.4.4">
<h3 data-number="5.4.4" class="anchored" data-anchor-id="poisson-approximation-to-the-binomial-for-rare-events"><span class="header-section-number">5.4.4</span> Poisson approximation to the binomial for rare events*</h3>
<p>Most applications of the Poisson distribution in epidemiology come from its relationship with the exponential distribution, but the Poisson distribution also has a useful relationship with the binomial distribution. When <span class="math inline">\(n\)</span> is large and <span class="math inline">\(p\)</span> is small, the binomial(<span class="math inline">\(n, p\)</span>) distribution can be approximated by a Poisson(<span class="math inline">\(n p\)</span>) distribution. More specifically, imagine that <span class="math inline">\(n\)</span> increases and <span class="math inline">\(p\)</span> decreases such that <span class="math inline">\(n p = \mu\)</span> stays constant. The binomial(<span class="math inline">\(n, p\)</span>) probability mass function is <span class="math display">\[
  \Pr(X = k) = \binom{n}{k} p^k (1 - p)^{n - k} = \frac{n!}{(n - k)! k!} p^k (1 - p)^{n - k}.
\]</span> When <span class="math inline">\(n\)</span> is much larger than <span class="math inline">\(k\)</span>, we have <span class="math display">\[
  \frac{n!}{(n - k)! k!} \approx \frac{n^k}{k!}.
\]</span> Because <span class="math inline">\(p = \mu / n\)</span>, we also have <span class="math display">\[
  p^k = \frac{\mu^k}{n^k}
\]</span> for each <span class="math inline">\(n\)</span> and <span class="math display">\[
  (1 - p)^{n - k} = \Big(1 - \frac{\mu}{n}\Big)^{n - k}
  \longrightarrow e^{-\mu}
\]</span> as <span class="math inline">\(n \rightarrow \infty\)</span>. Putting all of this together, we get the following approximation to the binomial PMF <span class="math display">\[
  \Pr(X = k) \approx \frac{n^k \mu^k}{k! n^k} e^{-\mu}
  = \frac{\mu^k}{k!} e^{-\mu},
\]</span> which is the Poisson(<span class="math inline">\(\mu\)</span>) PMF.</p>
<p>As an approximation to the binomial distribution, the Poisson distribution can be used for rare events in many different contexts. The number of events such as automobile accidents or number of onsets of a rare disease in a given time period or area (or both) will often have a Poisson distribution. <span class="citation" data-cites="clarke1946application">Clarke (<a href="references.html#ref-clarke1946application" role="doc-biblioref">1946</a>)</span> describes an astonishing application of the Poisson distribution that occurred in London in World War II. The <a href="https://en.wikipedia.org/wiki/V-1_flying_bomb">V1 flying bomb</a> was a German cruise missile with an 850 kg warhead that was fired at London (and later at Belgium) in 1944 and 1945. Soon after the attacks began, many people felt that the bomb impacts were clustered in particular areas of London. British investigators used the Poisson distribution to determine whether the V1s were being aimed or fell randomly within the city.</p>
<p>They divided 144 square kilometers of central London into 576 squares of <span class="math inline">\(0.25\)</span> square kilometers each. By then, the total number of bombs that had fallen on the entire area was 537. If the bombs were falling randomly, the number of bombs in each square should have a Poisson distribution with mean <span class="math inline">\(537 / 576 \approx  0.932\)</span>. Grouping the squares by the number of bombs that had fallen on them yielded <a href="#tbl-V1" class="quarto-xref">Table&nbsp;<span>5.3</span></a>. The close fit to the Poisson distribution suggested that the bombs were falling randomly over the entire 144 square kilometers, not being aimed at particular targets within the city. Near the end of the war, analysis of captured V1s revealed that the guidance system was only accurate to a radius of about 6 kilometers, a circle large enough to encompass almost all of London at the time.</p>
<div id="tbl-V1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-V1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;5.3: Distribution of V1 bomb impacts in London <span class="citation" data-cites="clarke1946application">(<a href="references.html#ref-clarke1946application" role="doc-biblioref">Clarke 1946</a>)</span>.}
</figcaption>
<div aria-describedby="tbl-V1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>Number of</strong></td>
<td style="text-align: right;"><strong>Expected (Poisson)</strong></td>
<td style="text-align: right;"><strong>Actual number</strong></td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>impacts</strong></td>
<td style="text-align: right;"><strong>number of squares</strong></td>
<td style="text-align: right;"><strong>of squares</strong></td>
</tr>
<tr class="odd">
<td style="text-align: center;">0</td>
<td style="text-align: right;">226.74</td>
<td style="text-align: right;">229</td>
</tr>
<tr class="even">
<td style="text-align: center;">1</td>
<td style="text-align: right;">211.39</td>
<td style="text-align: right;">211</td>
</tr>
<tr class="odd">
<td style="text-align: center;">2</td>
<td style="text-align: right;">98.54</td>
<td style="text-align: right;">93</td>
</tr>
<tr class="even">
<td style="text-align: center;">3</td>
<td style="text-align: right;">30.62</td>
<td style="text-align: right;">35</td>
</tr>
<tr class="odd">
<td style="text-align: center;">4</td>
<td style="text-align: right;">7.14</td>
<td style="text-align: right;">7</td>
</tr>
<tr class="even">
<td style="text-align: center;">5+</td>
<td style="text-align: right;">1.57</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>Total squares</strong></td>
<td style="text-align: right;">576.00</td>
<td style="text-align: right;">576</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
</section>
<section id="bayesian-estimation-of-incidence-rates" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="bayesian-estimation-of-incidence-rates"><span class="header-section-number">5.5</span> Bayesian estimation of incidence rates</h2>
<p>As with a binomial probability, Bayesian methods can be used to estimate an incidence rate without making any large-sample assumptions. They also allow a prior distribution to be used to incorporate background knowledge about the possible values of <span class="math inline">\(\lambda_\true\)</span>.</p>
<section id="gamma-conjugate-distribution" class="level3" data-number="5.5.1">
<h3 data-number="5.5.1" class="anchored" data-anchor-id="gamma-conjugate-distribution"><span class="header-section-number">5.5.1</span> Gamma conjugate distribution</h3>
<p>The conjugate distribution for the exponential(<span class="math inline">\(\lambda\)</span>) and Poisson(<span class="math inline">\(\lambda T\)</span>) distributions is the <strong>gamma distribution</strong>, which has the PDF <span id="eq-gammaPDF"><span class="math display">\[
  f(x, \alpha, \beta)
  = \frac{\beta^\alpha}{\Gamma(\alpha)} x^{\alpha - 1} e^{-\beta x}
\tag{5.19}\]</span></span> where <span class="math inline">\(\alpha &gt; 0\)</span> is the shape parameter, <span class="math inline">\(\beta &gt; 0\)</span> is the rate parameter, and <span class="math inline">\(\Gamma(\alpha) = \int_0^\infty x^{\alpha - 1} \dif x\)</span> is the <em>gamma function</em>. If <span class="math inline">\(X\)</span> has a gamma(<span class="math inline">\(\alpha, \beta\)</span>) distribution, then <span class="math display">\[
  \E[X] = \frac{\alpha}{\beta}
\]</span> and variance <span class="math display">\[
  \Var(X) = \frac{\alpha}{\beta^2}
\]</span> The exponential(<span class="math inline">\(\beta\)</span>) distribution is a special case of the gamma distribution with shape <span class="math inline">\(\alpha = 1\)</span>.</p>
<p>If the prior PDF of an unknown exponential rate <span class="math inline">\(\lambda_\true\)</span> has a gamma(<span class="math inline">\(\alpha, \beta\)</span>) distribution, then <span class="math display">\[
  p(\lambda \given \data) \propto
  \big(\lambda^m e^{-\lambda T}\big) \big(\lambda^{\alpha - 1} e^{-\beta \lambda}\big)
  = \lambda^{m + \alpha - 1} e^{-\lambda (T + \beta)}.
\]</span> After normalizing, this is a gamma(<span class="math inline">\(m + \alpha, T + \beta\)</span>) distribution. The posterior mean is <span class="math display">\[
  \bar{\lambda} = \frac{m + \alpha}{T + \beta}
\]</span> and the posterior variance is <span class="math display">\[
  \frac{m + \alpha}{(T + \beta)^2} = \frac{\bar{\lambda}}{T + \beta}
\]</span> The equal-tailed <span class="math inline">\(1 - \alpha\)</span> credible interval has its limits at the <span class="math inline">\(\alpha / 2\)</span> and <span class="math inline">\(1 - \alpha / 2\)</span> quantiles of this distribution. <a href="#fig-incrate-Bayes" class="quarto-xref">Figure&nbsp;<span>5.2</span></a> shows an example of an uninformative Bayesian prior and a posterior distribution for the incidence rate.</p>
<div class="cell">
<div class="code-with-filename">
<details class="code-fold">
<summary>Code</summary>
<div class="code-with-filename-file">
<pre><strong>incrate-Bayes-plot.R</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Bayesian estimation of incidence rates</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.002</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>T <span class="ot">&lt;-</span> <span class="dv">25</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># plot of prior and posterior distributions</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, <span class="fu">dgamma</span>(x, <span class="at">shape =</span> <span class="fl">0.5</span> <span class="sc">+</span> m, <span class="at">rate =</span> <span class="fl">0.1</span> <span class="sc">+</span> T), <span class="at">type =</span> <span class="st">"n"</span>,</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"Incidence rate ("</span>, lambda, <span class="st">")"</span>)),</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Probability density"</span>)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="fu">grid</span>()</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, <span class="fu">dgamma</span>(x, <span class="at">shape =</span> <span class="fl">0.5</span>, <span class="at">rate =</span> <span class="fl">0.1</span>), <span class="at">lty =</span> <span class="st">"dashed"</span>)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, <span class="fu">dgamma</span>(x, <span class="at">shape =</span> <span class="fl">0.5</span> <span class="sc">+</span> m, <span class="at">rate =</span> <span class="fl">0.1</span> <span class="sc">+</span> T))</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">lty =</span> <span class="fu">c</span>(<span class="st">"dashed"</span>, <span class="st">"solid"</span>),</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"gamma(0.5, 0.1) prior"</span>, <span class="st">"gamma (4.5, 25.1) posterior"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell-output-display">
<div id="fig-incrate-Bayes" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-incrate-Bayes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="longitudinal_files/figure-html/fig-incrate-Bayes-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2" title="Figure&nbsp;5.2: The PDFs of a gamma(0.5, 0.1) prior distribution and the gamma(4.5, 25.1) posterior distribution that results from seeing 4 events in 25 person-years of observation. The units of the incidence rate events per year."><img src="longitudinal_files/figure-html/fig-incrate-Bayes-1.png" class="img-fluid figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-incrate-Bayes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.2: The PDFs of a gamma(0.5, 0.1) prior distribution and the gamma(4.5, 25.1) posterior distribution that results from seeing 4 events in 25 person-years of observation. The units of the incidence rate events per year.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="jeffreys-confidence-interval" class="level3" data-number="5.5.2">
<h3 data-number="5.5.2" class="anchored" data-anchor-id="jeffreys-confidence-interval"><span class="header-section-number">5.5.2</span> Jeffreys confidence interval</h3>
<p>If we fix the total person-time <span class="math inline">\(T\)</span> and model the number of events as a Poisson(<span class="math inline">\(\lambda T\)</span>) random variable, the Jeffreys prior has <span class="math inline">\(\alpha = 1 / 2\)</span> and <span class="math inline">\(\beta = 0\)</span> <span class="citation" data-cites="jeffreys1946invariant">(<a href="references.html#ref-jeffreys1946invariant" role="doc-biblioref">Jeffreys 1946</a>)</span>. This is an <em>improper prior</em> because the PDF has a total area of <span class="math inline">\(\infty\)</span> under the curve, but we get a proper posterior distribution (i.e., a posterior PDF with a total area of <span class="math inline">\(1\)</span>) as long as <span class="math inline">\(T &gt; 0\)</span>. The Jeffreys confidence interval for <span class="math inline">\(\lambda_\true\)</span> is the equal-tailed credible interval from the gamma(<span class="math inline">\(m + 1 / 2, T\)</span>) posterior distribution. If <span class="math inline">\(m = 0\)</span>, the lower limit can be set to zero. This confidence interval has good coverage probabilities and narrow widths similar to the likelihood ratio confidence interval <span class="citation" data-cites="brown2003interval swift2009comparison">(<a href="references.html#ref-brown2003interval" role="doc-biblioref">Brown, Cai, and DasGupta 2003</a>; <a href="references.html#ref-swift2009comparison" role="doc-biblioref">Swift 2009</a>)</span>.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">R</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>incrate-Bayes.R</strong></pre>
</div>
<div class="sourceCode" id="cb6" data-filename="incrate-Bayes.R"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Bayesian estimation of incidence rates with gamma conjugate distribution</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># incidence rate posterior mean, median, and equal-tailed credible limits</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>incrate_bayes <span class="ot">&lt;-</span> <span class="cf">function</span>(m, T, <span class="at">level=</span><span class="fl">0.95</span>, <span class="at">priora=</span><span class="fl">0.5</span>, <span class="at">priorb=</span><span class="dv">0</span>) {</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># default arguments are for the Jeffreys confidence interval</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  alpha <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> level</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  posta  <span class="ot">&lt;-</span> priora <span class="sc">+</span> m</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  postb <span class="ot">&lt;-</span> priorb <span class="sc">+</span> T</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (m <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    lower <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    lower <span class="ot">&lt;-</span> <span class="fu">qgamma</span>(alpha <span class="sc">/</span> <span class="dv">2</span>, <span class="at">shape =</span> posta, <span class="at">rate =</span> postb)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  upper <span class="ot">&lt;-</span> <span class="fu">qgamma</span>(<span class="dv">1</span> <span class="sc">-</span> alpha <span class="sc">/</span> <span class="dv">2</span>, <span class="at">shape =</span> posta, <span class="at">rate =</span> postb)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  postmean <span class="ot">&lt;-</span> posta <span class="sc">/</span> postb</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  postmedian <span class="ot">&lt;-</span> <span class="fu">qgamma</span>(<span class="fl">0.5</span>, <span class="at">shape =</span> posta, <span class="at">rate =</span> postb)</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">c</span>(<span class="at">postmean =</span> postmean, <span class="at">postmedian =</span> postmedian,</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>           <span class="at">lower =</span> lower, <span class="at">upper =</span> upper,</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>           <span class="at">priora =</span> priora, <span class="at">priorb =</span> priorb, <span class="at">level =</span> level))</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 7 events in 22 units of person-time</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="fu">incrate_bayes</span>(<span class="dv">7</span>, <span class="dv">22</span>)                          <span class="co"># Jeffreys 95% confidence interval</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="fu">incrate_bayes</span>(<span class="dv">7</span>, <span class="dv">22</span>, <span class="at">level =</span> <span class="fl">0.8</span>)             <span class="co"># Jeffreys 80% confidence interval</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="fu">incrate_bayes</span>(<span class="dv">7</span>, <span class="dv">22</span>, <span class="at">priora =</span> <span class="dv">1</span>, <span class="at">priorb =</span> <span class="dv">1</span>)  <span class="co"># uniform prior</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-alho1992prevalence" class="csl-entry" role="listitem">
Alho, Juha M. 1992. <span>“On Prevalence, Incidence, and Duration in General Stable Populations.”</span> <em>Biometrics</em> 48 (2): 587–92.
</div>
<div id="ref-birnbaum1964median" class="csl-entry" role="listitem">
Birnbaum, Allan. 1964. <span>“Median-Unbiased Estimators.”</span> <em>Bulletin of Mathematical Statistics</em> 11: 25–34.
</div>
<div id="ref-brown2003interval" class="csl-entry" role="listitem">
Brown, Lawrence D, T Tony Cai, and Anirban DasGupta. 2003. <span>“Interval Estimation in Exponential Families.”</span> <em>Statistica Sinica</em> 13: 19–49.
</div>
<div id="ref-clarke1946application" class="csl-entry" role="listitem">
Clarke, RD. 1946. <span>“An Application of the Poisson Distribution.”</span> <em>Journal of the Institute of Actuaries</em> 72 (3): 481–81.
</div>
<div id="ref-clayton1993statistical" class="csl-entry" role="listitem">
Clayton, David, and Michael Hills. 1993. <em>Statistical Models in Epidemiology</em>. Oxford University Press.
</div>
<div id="ref-cohen1994mid" class="csl-entry" role="listitem">
Cohen, Geoffrey R, and Shu-Ying Yang. 1994. <span>“Mid-p Confidence Intervals for the <span>Poisson</span> Expectation.”</span> <em>Statistics in Medicine</em> 13 (21): 2189–2203.
</div>
<div id="ref-elandt1975definition" class="csl-entry" role="listitem">
Elandt-Johnson, Regina C. 1975. <span>“Definition of Rates: Some Remarks on Their Use and Misuse.”</span> <em>American Journal of Epidemiology</em> 102 (4): 267–71.
</div>
<div id="ref-farr1838on" class="csl-entry" role="listitem">
Farr, William. 1838. <span>“On Prognosis.”</span> <em>British Medical Almanack</em> Supplement: 199–216.
</div>
<div id="ref-freeman1980prevalence" class="csl-entry" role="listitem">
Freeman, Jonathan, and George B Hutchison. 1980. <span>“Prevalence, Incidence and Duration.”</span> <em>American Journal of Epidemiology</em> 112 (5): 707–23.
</div>
<div id="ref-garwood1936fiducial" class="csl-entry" role="listitem">
Garwood, F. 1936. <span>“Fiducial Limits for the <span>Poisson</span> Distribution.”</span> <em>Biometrika</em> 28 (3/4): 437–42.
</div>
<div id="ref-gompertz1825mortality" class="csl-entry" role="listitem">
Gompertz, Benjamin. 1825. <span>“<span>XXIV</span>. <span>O</span>n the Nature of the Function Expressive of the Law of Human Mortality, and on a New Mode of Determining the Value of Life Contingencies.”</span> <em>Philosophical Transactions of the Royal Society of London</em> 115: 513–83.
</div>
<div id="ref-jeffreys1946invariant" class="csl-entry" role="listitem">
Jeffreys, Harold. 1946. <span>“An Invariant Form for the Prior Probability in Estimation Problems.”</span> <em>Proceedings of the Royal Society of London. Series A. Mathematical and Physical Sciences</em> 186 (1007): 453–61.
</div>
<div id="ref-keiding1991age" class="csl-entry" role="listitem">
Keiding, Niels. 1991. <span>“Age-Specific Incidence and Prevalence: A Statistical Perspective.”</span> <em>Journal of the Royal Statistical Society: Series A (Statistics in Society)</em> 154 (3): 371–96.
</div>
<div id="ref-lancaster1961significance" class="csl-entry" role="listitem">
Lancaster, H Oliver. 1961. <span>“Significance Tests in Discrete Distributions.”</span> <em>Journal of the American Statistical Association</em> 56 (294): 223–34.
</div>
<div id="ref-makeham1860law" class="csl-entry" role="listitem">
Makeham, William Matthew. 1860. <span>“On the Law of Mortality and the Construction of Annuity Tables.”</span> <em>The Assurance Magazine, and Journal of the Institute of Actuaries</em> 8 (6): 301–10.
</div>
<div id="ref-morgenstern1980measures" class="csl-entry" role="listitem">
Morgenstern, Hal, David G Kleinbaum, and Lawrence L Kupper. 1980. <span>“Measures of Disease Incidence Used in Epidemiologic Research.”</span> <em>International Journal of Epidemiology</em> 9 (1): 97–104.
</div>
<div id="ref-preston1987relations" class="csl-entry" role="listitem">
Preston, Samuel H. 1987. <span>“Relations Among Standard Epidemiologic Measures in a Population.”</span> <em>American Journal of Epidemiology</em> 126 (2): 336–45.
</div>
<div id="ref-swift2009comparison" class="csl-entry" role="listitem">
Swift, Michael Bruce. 2009. <span>“Comparison of Confidence Intervals for a <span>Poisson</span> Mean–Further Considerations.”</span> <em>Communications in Statistics–Theory and Methods</em> 38 (5): 748–59.
</div>
</div>
</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p> <a href="https://en.wikipedia.org/wiki/William_Farr">William Farr</a> (1807–1883) was a British pioneer of epidemiology. As the first statistician in the General Register Office, he was responsible for the collection of medical statistics in England and Wales He set up a system for recording causes of death that allowed comparison of mortality rates. In the quote, “consumption” and “phthisis” both refer to tuberculosis.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p> To be predictable, it is sufficient for a process to be left-continuous. The disease onset process is assumed to be right-continuous with left-hand limits (cadlag) and hence unpredictable.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p> Using integration by parts, we get that <span class="math display">\[
    \int_0^\infty t f(t) \,\dif t = -t S(t) \Big|_0^\infty + \int_0^\infty S(t) \,\dif t = \int_0^\infty S(t) \,\dif t
  \]</span> when <span class="math inline">\(t S(t) \rightarrow 0\)</span> as <span class="math inline">\(t \rightarrow \infty\)</span>.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p> When <span class="math inline">\(T\)</span> is discrete (or a mixture of continuous and discrete components), <span class="math display">\[
    t_p = \inf\{t: F(t) \geq p\} = \inf\{t: S(t) \leq 1 - p\}.
  \]</span> When <span class="math inline">\(T\)</span> is continuous, this reduces to <a href="#eq-Squantile" class="quarto-xref">Equation&nbsp;<span>5.3</span></a>.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p> Named after <a href="https://en.wikipedia.org/wiki/Sim%C3%A9on_Denis_Poisson">Sim'{e}on Denis Poisson</a> (1781-1840), a French mathematician, physicist, and astronomer. He introduced the distribution in an 1837 paper in which he estimated the number of wrongful convictions that would occur over a given time period. His is one of the 72 names inscribed on the Eiffel Tower.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./bayes.html" class="pagination-link" aria-label="Bayesian Estimation">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Bayesian Estimation</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./survival.html" class="pagination-link" aria-label="One-Sample Survival Analysis">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">One-Sample Survival Analysis</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




<script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>